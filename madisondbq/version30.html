<!DOCTYPE html>
<html lang="en" dir="ltr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madison DBQ Smartboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- 
      This <style> block contains all custom styles, including:
      1. Base font styles and CSS variables.
      2. Custom highlighting styles.
      3. Custom High Contrast styles.
      4. Custom Dark Mode styles (now default).
      5. Right-to-Left (RTL) support for Arabic.
    -->
    <style>
        :root {
            /* Set the base font size for scaling */
            --base-font-size: 1.75rem; /* Large base for smartboard */
            --base-line-height: 1.6;
            font-family: 'Inter', sans-serif;
        }

        /* Base styles for document text */
        .doc-text p, .doc-text ol {
            font-size: var(--base-font-size);
            line-height: var(--base-line-height);
            margin-bottom: 1.5rem;
        }
        .doc-text h2 {
            font-size: calc(var(--base-font-size) * 1.5);
            line-height: 1.3;
            font-weight: 700;
            margin-bottom: 1rem;
            margin-top: 2rem;
        }
        .doc-text h3 {
            font-size: calc(var(--base-font-size) * 1.2);
            line-height: 1.4;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }
        /* Changed from ul to ol for numbered list */
        .doc-text ol {
            list-style-type: decimal;
            padding-left: 40px;
        }
        
        /* Simplifier: Clickable term link */
        .simplifier {
            color: #2563eb; /* blue-600 */
            font-weight: 600;
            cursor: pointer;
            text-decoration: underline;
            text-decoration-style: dotted;
        }
        html.dark .simplifier {
            color: #60a5fa; /* blue-400 */
        }

        /* Active tab button style */
        .tab-btn.active {
            background-color: #3b82f6; /* blue-500 */
            color: #ffffff;
        }
        html.dark .tab-btn.active {
            background-color: #60a5fa; /* blue-400 */
            color: #111827; /* gray-900 */
        }
        
        /* Accessibility control button active style */
        .control-btn.active-toggle {
            background-color: #3b82f6; /* blue-500 */
            color: #ffffff;
        }
        html.dark .control-btn.active-toggle {
            background-color: #60a5fa; /* blue-400 */
            color: #111827; /* gray-900 */
        }

        /* Reading Ruler (Focus Mode) */
        #reading-ruler {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 50px; /* Adjust height as needed */
            background-color: #3b82f6; /* blue-500 */
            opacity: 0.3;
            pointer-events: none; /* Allows clicks to pass through */
            display: none; /* Hidden by default */
            z-index: 9998;
        }
        html.dark #reading-ruler {
            background-color: #60a5fa; /* blue-400 */
        }

        /* Highlighter Styles */
        .highlight {
            background-color: #fef08a; /* yellow-200 */
            cursor: pointer;
        }
        html.dark .highlight {
            background-color: #facc15; /* yellow-500 */
            color: #1f2937; /* gray-800 */
        }
        
        /* MANUAL DARK MODE STYLES (Default) */
        html.dark {
            background-color: #1f2937; /* gray-800 */
            color: #d1d5db; /* gray-300 */
        }
        html.dark body {
            background-color: #1f2937; /* gray-800 */
            color: #d1d5db; /* gray-300 */
        }
        html.dark .tab-btn {
            background-color: #374151; /* gray-700 */
            color: #d1d5db; /* gray-300 */
        }
        html.dark .tab-btn:hover {
            background-color: #4b5563; /* gray-600 */
        }
        html.dark .control-btn {
            background-color: #4b5563; /* gray-600 */
            color: #f3f4f6; /* gray-100 */
        }
        html.dark .control-btn:hover {
            background-color: #52525b; /* zinc-600 */
        }
        html.dark .doc-content {
            background-color: #374151; /* gray-700 */
            border-color: #4b5563; /* gray-600 */
        }
        html.dark .modal-content {
            background-color: #374151; /* gray-700 */
        }
        html.dark .modal-header {
            background-color: #4b5563; /* gray-600 */
            color: #ffffff;
        }
        html.dark #main-title {
            color: #f9fafb; /* gray-50 */
        }
        html.dark #lang-switcher a {
            color: #d1d5db; /* gray-300 */
        }

        /* MANUAL LIGHT MODE STYLES (Opt-in) */
        html:not(.dark) {
            background-color: #f3f4f6; /* gray-100 */
            color: #111827; /* gray-900 */
        }
        html:not(.dark) body {
            background-color: #f3f4f6; /* gray-100 */
            color: #111827; /* gray-900 */
        }
        html:not(.dark) .tab-btn {
            background-color: #e5e7eb; /* gray-200 */
            color: #1f2937; /* gray-800 */
        }
        html:not(.dark) .tab-btn:hover {
            background-color: #d1d5db; /* gray-300 */
        }
        html:not(.dark) .control-btn {
            background-color: #e5e7eb; /* gray-200 */
            color: #1f2937; /* gray-800 */
        }
        html:not(.dark) .control-btn:hover {
            background-color: #d1d5db; /* gray-300 */
        }
        html:not(.dark) .doc-content {
            background-color: #ffffff; /* white */
            border-color: #e5e7eb; /* gray-200 */
        }
        html:not(.dark) .modal-content {
            background-color: #ffffff; /* white */
        }
        html:not(.dark) .modal-header {
            background-color: #f3f4f6; /* gray-100 */
            color: #111827; /* gray-900 */
        }
        html:not(.dark) #main-title {
            color: #111827; /* gray-900 */
        }
        html:not(.dark) #lang-switcher a {
            color: #374151; /* gray-700 */
        }


        /* HIGH CONTRAST MODE STYLES */
        #app-container.high-contrast {
            background-color: #000000;
            color: #ffffff;
        }
        #app-container.high-contrast .tab-btn,
        #app-container.high-contrast .control-btn {
            background-color: #000000;
            color: #ffff00; /* Yellow text */
            border: 2px solid #ffff00;
        }
        #app-container.high-contrast .tab-btn.active,
        #app-container.high-contrast .control-btn.active-toggle {
            background-color: #ffff00; /* Yellow background */
            color: #000000; /* Black text */
        }
        #app-container.high-contrast .doc-content {
            background-color: #000000;
            border-color: #ffff00;
        }
        #app-container.high-contrast .simplifier {
            color: #00ffff; /* Cyan links */
            text-decoration: underline;
        }
        #app-container.high-contrast .modal-content {
            background-color: #000000;
            border: 2px solid #ffff00;
        }
        #app-container.high-contrast .modal-header {
            background-color: #ffff00;
            color: #000000;
        }
        #app-container.high-contrast #main-title,
        #app-container.high-contrast #lang-switcher a {
            color: #ffff00;
        }
        
        /* Right-to-Left (RTL) Styles for Arabic */
        [dir="rtl"] {
            text-align: right;
        }
        [dir="rtl"] ol {
            padding-left: 0;
            padding-right: 40px; /* RTL padding */
        }
        [dir="rtl"] .tab-nav {
            justify-content: flex-end; /* Align tabs to the right */
        }
        [dir="rtl"] #lang-switcher {
            left: 1rem; /* Move to top-left */
            right: auto;
        }
        [dir="rtl"] .doc-content {
            margin-left: 0;
            margin-right: auto;
        }
        [dir="rtl"] .control-btn {
            flex-direction: row-reverse; /* Flip icon and text */
        }
        [dir="rtl"] .modal-header {
            flex-direction: row-reverse;
        }
        [dir="rtl"] .modal-close {
            margin-left: 0;
            margin-right: auto;
        }
        /* Style for the new simplified text toggle */
        [dir="rtl"] .simplify-toggle-btn {
            float: left; /* Move to the left in RTL */
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Main Application Container -->
    <div id="app-container" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2 md:py-8 relative">

        <!-- Language Switcher -->
        <div id="lang-switcher" class="absolute top-4 right-4 z-20">
            <a href="#" class="lang-select font-bold py-1 px-2 rounded-lg" data-lang="en">ğŸ‡ºğŸ‡¸ EN</a>
            <a href="#" class="lang-select py-1 px-2 rounded-lg" data-lang="es">ğŸ‡ªğŸ‡¸ ES</a>
            <a href="#" class="lang-select py-1 px-2 rounded-lg" data-lang="ar">ğŸ‡¸ğŸ‡¦ AR</a>
        </div>

        <!-- Header -->
        <header class="text-center pt-16 md:pt-2 pb-8">
            <h1 id="main-title" class="text-4xl md:text-6xl font-bold" data-key="main_title">Madison & the Republic</h1>
        </header>

        <!-- Tab Navigation -->
        <nav class="mb-6">
            <ul class="tab-nav flex flex-wrap justify-center gap-2 md:gap-4">
                <li><button class="tab-btn active text-lg md:text-2xl font-semibold py-3 px-5 rounded-lg transition-colors duration-200" data-tab="questions" data-key="tab_questions">Key Questions â“</button></li>
                <li><button class="tab-btn text-lg md:text-2xl font-semibold py-3 px-5 rounded-lg transition-colors duration-200" data-tab="fed10" data-key="tab_fed10">Fed. 10 ğŸ“œ</button></li>
                <li><button class="tab-btn text-lg md:text-2xl font-semibold py-3 px-5 rounded-lg transition-colors duration-200" data-tab="fed39" data-key="tab_fed39">Fed. 39 ğŸ›ï¸</button></li>
                <li><button class="tab-btn text-lg md:text-2xl font-semibold py-3 px-5 rounded-lg transition-colors duration-200" data-tab="fed51" data-key="tab_fed51">Fed. 51 âš–ï¸</button></li>
            </ul>
        </nav>

        <!-- Content Area -->
        <main>
            <!-- Socratic Seminar Tab Content (Replaced Key Questions) -->
            <div id="questions" class="tab-content doc-content p-6 md:p-10 rounded-lg shadow-lg">
                <div class="doc-text">
                    <h2 data-key="socratic_heading">Socratic Seminar Questions</h2>
                    <!-- Using <ol> for numbered list -->
                    <ol class="space-y-4">
                        <li data-key="s_q1">Madison seems very worried about "<span class="simplifier" data-term="faction">factions</span>" (Fed 10). Do you agree that this is the biggest danger in a democracy? Why or why not?</li>
                        <li data-key="s_q2">What is the main difference between a "<span class="simplifier" data-term="pure_democracy">pure democracy</span>" and a "<span class="simplifier" data-term="republic">republic</span>"? Why does Madison believe a republic is safer? (Fed 10)</li>
                        <li data-key="s_q3">According to Madison, where does a government's power come from? (Fed 39). How does this connect to the idea of "<span class="simplifier" data-term="dependence_people">dependence on the people</span>"? (Fed 51)</li>
                        <li data-key="s_q4">Madison says, "If men were angels, no government would be necessary" (Fed 51). What does he mean by this? How does this idea justify the need for "<span class="simplifier" data-term="auxiliary_precautions">auxiliary precautions</span>"?</li>
                        <li data-key="s_q5">Can "ambition... be made to counteract ambition" (Fed 51)? Can you think of a modern example where one part of the government (or one person) "checks" another?</li>
                        <li data-key="s_q6">Is Madison's system of a large republic (Fed 10) and <span class="simplifier" data-term="internal_controls">internal controls</span> (Fed 51) enough to protect the rights of a minority group? When might it fail?</li>
                    </ol>
                </div>
            </div>

            <!-- Federalist 10 Tab Content -->
            <div id="fed10" class="tab-content doc-content p-6 md:p-10 rounded-lg shadow-lg hidden">
                <!-- NEW: Simplified Text Toggle -->
                <button class="simplify-toggle-btn tab-btn text-lg md:text-xl font-semibold py-2 px-4 rounded-lg transition-colors duration-200 mb-4 inline-flex items-center gap-2 float-right" data-doc="fed10">
                    <span data-key="show_translation">Show Modern Translation ğŸ“–</span>
                </button>
                <button class="show-main-idea-btn tab-btn text-lg md:text-xl font-semibold py-2 px-4 rounded-lg transition-colors duration-200 mb-4 inline-flex items-center gap-2" data-key="main_idea_fed10" data-idea="idea_fed10">
                    ğŸ’¡ <span data-key="show_main_idea">Show Main Idea</span>
                </button>
                <div class="doc-text">
                    <!-- NEW: Original Text Container -->
                    <div class="doc-original">
                        <h2>Federalist No. 10 (1787)</h2>
                        <p>A <span class="simplifier" data-term="pure_democracy">pure democracy</span>, by which I mean a society consisting of a small number of citizens, who assemble and administer the government in person, can admit of no cure for the <span class="simplifier" data-term="mischiefs_faction">mischiefs of faction</span>. A common passion or interest will, in almost every case, be felt by a majority of the whole...and there is nothing to check the inducements to sacrifice the weaker party or an obnoxious individual.</p>
                        <p>A <span class="simplifier" data-term="republic">republic</span>, by which I mean a government in which the scheme of <span class="simplifier" data-term="representation">representation</span> takes place, opens a different prospect, and promises the cure for which we are seeking. The two great points of difference between a democracy and a republic are: first, the delegation of the government, in the latter, to a small number of citizens elected by the rest; secondly, the greater number of citizens, and greater sphere of country, over which the latter may be extended.</p>
                    </div>
                    <!-- NEW: Simplified Text Container -->
                    <div class="doc-simplified hidden">
                        <h2 data-key="simple_fed10_h">Federalist No. 10 (Modern Translation)</h2>
                        <p data-key="simple_fed10_p1"></p>
                        <p data-key="simple_fed10_p2"></p>
                    </div>
                </div>
            </div>
            
            <!-- Federalist 39 Tab Content -->
            <div id="fed39" class="tab-content doc-content p-6 md:p-10 rounded-lg shadow-lg hidden">
                <!-- NEW: Simplified Text Toggle -->
                <button class="simplify-toggle-btn tab-btn text-lg md:text-xl font-semibold py-2 px-4 rounded-lg transition-colors duration-200 mb-4 inline-flex items-center gap-2 float-right" data-doc="fed39">
                    <span data-key="show_translation">Show Modern Translation ğŸ“–</span>
                </button>
                <button class="show-main-idea-btn tab-btn text-lg md:text-xl font-semibold py-2 px-4 rounded-lg transition-colors duration-200 mb-4 inline-flex items-center gap-2" data-key="main_idea_fed39" data-idea="idea_fed39">
                    ğŸ’¡ <span data-key="show_main_idea">Show Main Idea</span>
                </button>
                <div class="doc-text">
                    <!-- NEW: Original Text Container -->
                    <div class="doc-original">
                        <h2>Federalist No. 39 (1788)</h2>
                        <p>We may define a <span class="simplifier" data-term="republic">republic</span> to be...a government which derives all its powers directly or indirectly from the <span class="simplifier" data-term="great_body">great body of the people</span>, and is administered by persons holding their offices during pleasure, for a limited period, or during good behavior. It is ESSENTIAL to such a government that it be derived from the great body of the society, not from an inconsiderable proportion, or a <span class="simplifier" data-term="favored_class">favored class</span> of it... It is SUFFICIENT for such a government that the persons administering it be appointed, either directly or indirectly, by the people.</p>
                    </div>
                    <!-- NEW: Simplified Text Container -->
                    <div class="doc-simplified hidden">
                        <h2 data-key="simple_fed39_h">Federalist No. 39 (Modern Translation)</h2>
                        <p data-key="simple_fed39_p1"></p>
                    </div>
                </div>
            </div>

            <!-- Federalist 51 Tab Content -->
            <div id="fed51" class="tab-content doc-content p-6 md:p-10 rounded-lg shadow-lg hidden">
                <!-- NEW: Simplified Text Toggle -->
                <button class="simplify-toggle-btn tab-btn text-lg md:text-xl font-semibold py-2 px-4 rounded-lg transition-colors duration-200 mb-4 inline-flex items-center gap-2 float-right" data-doc="fed51">
                    <span data-key="show_translation">Show Modern Translation ğŸ“–</span>
                </button>
                <button class="show-main-idea-btn tab-btn text-lg md:text-xl font-semibold py-2 px-4 rounded-lg transition-colors duration-200 mb-4 inline-flex items-center gap-2" data-key="main_idea_fed51" data-idea="idea_fed51">
                    ğŸ’¡ <span data-key="show_main_idea">Show Main Idea</span>
                </button>
                <div class="doc-text">
                    <!-- NEW: Original Text Container -->
                    <div class="doc-original">
                        <h2>Federalist No. 51 (1788)</h2>
                        <p>"If men were angels, no government would be necessary. If angels were to govern men, neither external nor <span class="simplifier" data-term="internal_controls">internal controls</span> on government would be necessary. In framing a government which is to be administered by men over men, the great difficulty lies in this: you must first enable the government to control the governed; and in the next place oblige it to control itself."</p>
                        <p>A <span class="simplifier" data-term="dependence_people">dependence on the people</span> is, no doubt, the primary control on the government; but experience has taught mankind the necessity of <span class="simplifier" data-term="auxiliary_precautions">auxiliary precautions</span>... Ambition must be made to counteract ambition. The interest of the man must be connected with the constitutional rights of the place.</p>
                    </div>
                    <!-- NEW: Simplified Text Container -->
                    <div class="doc-simplified hidden">
                        <h2 data-key="simple_fed51_h">Federalist No. 51 (Modern Translation)</h2>
                        <p data-key="simple_fed51_p1"></p>
                        <p data-key="simple_fed51_p2"></p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Accessibility Footer -->
    <footer class="sticky bottom-0 z-10">
        <div id="tools-header" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <button id="toggle-tools-btn" class="control-btn w-full py-3 px-5 text-2xl font-bold rounded-t-lg transition-colors duration-200" data-key="toggle_tools">
                Accessibility Tools ğŸ› ï¸
            </button>
        </div>
        
        <div id="tools-panel" class="hidden py-4">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3">
                
                <!-- Font Size -->
                <div class="flex items-center gap-3">
                    <button id="font-decrease" class="control-btn py-4 px-6 text-3xl" aria-label="Decrease font size">
                        A-
                    </button>
                    <button id="font-increase" class="control-btn py-4 px-6 text-3xl" aria-label="Increase font size">
                        A+
                    </button>
                </div>

                <!-- Read Aloud -->
                <div class="flex items-center gap-3">
                    <button id="read-aloud" class="control-btn py-4 px-6 text-2xl inline-flex items-center gap-3" aria-label="Read text aloud">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.972 7.972 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z" clip-rule="evenodd" /></svg>
                        <span data-key="read_aloud">Speak ğŸ—£ï¸</span>
                    </button>
                </div>

                <!-- High Contrast -->
                <div class="flex items-center gap-3">
                    <button id="contrast-toggle" class="control-btn py-4 px-6 text-2xl inline-flex items-center gap-3" aria-label="Toggle high contrast mode">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 10a.5.5 0 000 0h.01a.5.5 0 000 0H8zm2 0a.5.5 0 000 0h.01a.5.5 0 000 0H10zM
                        m-4 0a.5.5 0 000 0h.01a.5.5 0 000 0H6z" clip-rule="evenodd" /><path d="M10 2a8 8 0 100 16v-2a6 6 0 110-12V2z" /></svg>
                        <span data-key="high_contrast">Contrast ğŸŸ¡</span>
                    </button>
                </div>
                
                <!-- Reading Ruler -->
                <div class="flex items-center gap-3">
                    <button id="ruler-toggle" class="control-btn py-4 px-6 text-2xl inline-flex items-center gap-3" aria-label="Toggle reading ruler">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zM13 10a1 1 0 011-1h3a1 1 0 011 1v2a1 1 0 01-1 1h-3a1 1 0 01-1-1v-2z" /></svg>
                        <span data-key="focus">Focus ğŸ‘ï¸</span>
                    </button>
                </div>

                <!-- Highlighter -->
                <div class="flex items-center gap-3">
                    <button id="highlighter-toggle" class="control-btn py-4 px-6 text-2xl inline-flex items-center gap-3" aria-label="Toggle highlighter mode">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
                        <span data-key="highlighter">Highlighter  highlighter</span>
                    </button>
                </div>

                <!-- Light Mode Toggle -->
                <div class="flex items-center gap-3">
                    <button id="light-mode-toggle" class="control-btn py-4 px-6 text-2xl inline-flex items-center gap-3 active-toggle" aria-label="Toggle light mode">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm-7.071-.707a1 1 0 00-1.414 1.414l.707.707a1 1 0 001.414-1.414l-.707-.707zM3 10a1 1 0 011-1h1a1 1 0 110 2H4a1 1 0 01-1-1zm14 0a1 1 0 011-1h1a1 1 0 110 2h-1a1 1 0 01-1-1zm-8.293-6.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM6.293 13.707a1 1 0 00-1.414 1.414l.707.707a1 1 0 001.414-1.414l-.707-.707z" clip-rule="evenodd" /></svg>
                        <span data-key="dark_mode">Light Mode â˜€ï¸</span>
                    </button>
                </div>
                
                <!-- Full Screen Toggle -->
                <div class="flex items-center gap-3">
                    <button id="fullscreen-toggle" class="control-btn py-4 px-6 text-2xl inline-flex items-center gap-3" aria-label="Toggle full screen">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h4a1 1 0 110 2H5v3a1 1 0 11-2 0V4zm14 0a1 1 0 011 1v3a1 1 0 11-2 0V5h-3a1 1 0 110-2h4zM3 16a1 1 0 011 1v-3a1 1 0 11-2 0v3a1 1 0 011-1zm14 0a1 1 0 011 1v-3a1 1 0 11-2 0v3h-3a1 1 0 110 2h4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                        <span data-key="fullscreen">Full Screen</span>
                    </button>
                </div>
            </div>
        </div>
    </footer>

    <!-- Reading Ruler Element -->
    <div id="reading-ruler"></div>

    <!-- Modal for Definitions -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content w-full max-w-2xl rounded-lg shadow-2xl overflow-hidden">
            <div class="modal-header flex items-center justify-between p-4">
                <h2 id="modal-term" class="text-3xl font-bold">Term</h2>
                <button id="modal-close" class="modal-close text-4xl font-light leading-none">&times;</button>
            </div>
            <div class="p-6">
                <p id="modal-definition" class="text-2xl">Definition</p>
            </div>
        </div>
    </div>

    <!-- Main Application Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.tab-btn');
            const contents = document.querySelectorAll('.tab-content');
            const appContainer = document.getElementById('app-container');
            let activeTab = 'questions'; // Default tab
            let currentLang = 'en'; // Default language

            // *** FONT SIZE LOGIC ***
            const fontDecreaseBtn = document.getElementById('font-decrease');
            const fontIncreaseBtn = document.getElementById('font-increase');
            const root = document.documentElement;

            function changeFontSize(direction) {
                let currentSizeString = getComputedStyle(root).getPropertyValue('--base-font-size');
                let currentSize = parseFloat(currentSizeString);
                
                if (direction === 'increase') {
                    currentSize += 0.1;
                } else if (direction === 'decrease') {
                    currentSize = Math.max(1, currentSize - 0.1);
                }
                root.style.setProperty('--base-font-size', `${currentSize}rem`);
            }

            fontIncreaseBtn.addEventListener('click', () => changeFontSize('increase'));
            fontDecreaseBtn.addEventListener('click', () => changeFontSize('decrease'));
            // *** END OF FONT SIZE LOGIC ***


            // --- Translation Data ---
            const translations = {
                en: {
                    main_title: "Madison & the Republic",
                    tab_questions: "Key Questions â“",
                    tab_fed10: "Fed. 10 ğŸ“œ",
                    tab_fed39: "Fed. 39 ğŸ›ï¸",
                    tab_fed51: "Fed. 51 âš–ï¸",
                    // SOCRATIC SEMINAR QUESTIONS
                    socratic_heading: "Socratic Seminar Questions",
                    s_q1: "Madison seems very worried about 'factions' (Fed 10). Do you agree that this is the biggest danger in a democracy? Why or why not?",
                    s_q2: "What is the main difference between a 'pure democracy' and a 'republic'? Why does Madison believe a republic is safer? (Fed 10)",
                    s_q3: "According to Madison, where does a government's power come from? (Fed 39). How does this connect to the idea of 'dependence on the people'? (Fed 51)",
                    s_q4: "Madison says, 'If men were angels, no government would be necessary' (Fed 51). What does he mean by this? How does this idea justify the need for 'auxiliary precautions'?",
                    s_q5: "Can 'ambition... be made to counteract ambition' (Fed 51)? Can you think of a modern example where one part of the government (or one person) 'checks' another?",
                    s_q6: "Is Madison's system of a large republic (Fed 10) and 'internal controls' (Fed 51) enough to protect the rights of a minority group? When might it fail?",
                    // END SOCRATIC
                    show_main_idea: "Show Main Idea",
                    // Main Idea Text
                    idea_fed10: "A large republic is better than a small democracy at controlling the problems caused by 'factions' (groups of citizens with a common interest).",
                    idea_fed39: "A republic is a government that gets its power from the people, not from a small or 'favored' group.",
                    idea_fed51: "Because people aren't angels, government must be set up with 'auxiliary precautions' (checks and balances) to control itself.",
                    idea_title_fed10: "Main Idea: Federalist 10",
                    idea_title_fed39: "Main Idea: Federalist 39",
                    idea_title_fed51: "Main Idea: Federalist 51",
                    // *** NEW: Modern Translation Keys ***
                    show_translation: "Show Modern Translation ğŸ“–",
                    show_original: "Show Original Text ğŸ“œ",
                    simple_fed10_h: "Federalist No. 10 (Modern Translation)",
                    simple_fed10_p1: "A 'pure democracy' (where all citizens vote on everything) can't fix the problem of 'factions' (groups that harm others). If a majority wants to do something bad, there's nothing to stop them from hurting the minority.",
                    simple_fed10_p2: "A 'republic' (where we elect representatives) is different and offers a solution. The two big differences are: 1) We give the job of governing to a small, elected group. 2) A republic can work for a much larger country with more citizens.",
                    simple_fed39_h: "Federalist No. 39 (Modern Translation)",
                    simple_fed39_p1: "A republic is a government that gets its power from the people, not from a small, favored group. It's 'essential' that the government represents the whole society. It's 'sufficient' that the leaders are chosen by the people, either directly or indirectly.",
                    simple_fed51_h: "Federalist No. 51 (Modern Translation)",
                    simple_fed51_p1: "If people were angels, we wouldn't need government. If angels were in charge, we wouldn't need controls on them. But we have humans governing humans, so the government must be able to control the people, and it must also be forced to control itself.",
                    simple_fed51_p2: "Elections (depending on the people) are the main control. But experience shows we also need 'auxiliary precautions' (backup systems). We must use ambition to check ambition, connecting a leader's personal interests to their official duties.",
                    // Tools
                    toggle_tools: "Accessibility Tools ğŸ› ï¸",
                    read_aloud: "Speak ğŸ—£ï¸",
                    high_contrast: "Contrast ğŸŸ¡",
                    focus: "Focus ğŸ‘ï¸",
                    highlighter: "Highlighter  highlighter",
                    dark_mode: "Light Mode â˜€ï¸",
                    fullscreen: "Full Screen"
                },
                es: {
                    main_title: "Madison y la RepÃºblica",
                    tab_questions: "Preguntas Clave â“",
                    tab_fed10: "Fed. 10 ğŸ“œ",
                    tab_fed39: "Fed. 39 ğŸ›ï¸",
                    tab_fed51: "Fed. 51 âš–ï¸",
                    // SOCRATIC SEMINAR QUESTIONS
                    socratic_heading: "Preguntas del Seminario SocrÃ¡tico",
                    s_q1: "Madison parece muy preocupado por las 'facciones' (Fed 10). Â¿EstÃ¡s de acuerdo en que este es el mayor peligro en una democracia? Â¿Por quÃ© o por quÃ© no?",
                    s_q2: "Â¿CuÃ¡l es la principal diferencia entre una 'democracia pura' y una 'repÃºblica'? Â¿Por quÃ© cree Madison que una repÃºblica es mÃ¡s segura? (Fed 10)",
                    s_q3: "SegÃºn Madison, Â¿de dÃ³nde proviene el poder de un gobierno? (Fed 39). Â¿CÃ³mo se conecta esto con la idea de 'dependencia del pueblo'? (Fed 51)",
                    s_q4: "Madison dice: 'Si los hombres fueran Ã¡ngeles, no serÃ­a necesario ningÃºn gobierno' (Fed 51). Â¿QuÃ© quiere decir con esto? Â¿CÃ³mo justifica esta idea la necesidad de 'precauciones auxiliares'?",
                    s_q5: "Â¿Puede la 'ambiciÃ³n... contrarrestar a la ambiciÃ³n' (Fed 51)? Â¿Puedes pensar en un ejemplo moderno en el que una parte del gobierno (o una persona) 'controle' a otra?",
                    s_q6: "Â¿Es el sistema de Madison de una gran repÃºblica (Fed 10) y 'controles internos' (Fed 51) suficiente para proteger los derechos de un grupo minoritario? Â¿CuÃ¡ndo podrÃ­a fallar?",
                    // END SOCRATIC
                    show_main_idea: "Mostrar Idea Principal",
                    // Main Idea Text
                    idea_fed10: "Una repÃºblica grande es mejor que una democracia pequeÃ±a para controlar los problemas causados por 'facciones' (grupos de ciudadanos con un interÃ©s comÃºn).",
                    idea_fed39: "Una repÃºblica es un gobierno que obtiene su poder del pueblo, no de un grupo pequeÃ±o o 'favorecido'.",
                    idea_fed51: "Dado que las personas no son Ã¡ngeles, el gobierno debe establecerse con 'precauciones auxiliares' (controles y equilibrios) para controlarse a sÃ­ mismo.",
                    idea_title_fed10: "Idea Principal: El Federalista 10",
                    idea_title_fed39: "Idea Principal: El Federalista 39",
                    idea_title_fed51: "Idea Principal: El Federalista 51",
                    // *** NEW: Modern Translation Keys ***
                    show_translation: "Mostrar TraducciÃ³n Moderna ğŸ“–",
                    show_original: "Mostrar Texto Original ğŸ“œ",
                    simple_fed10_h: "El Federalista No. 10 (TraducciÃ³n Moderna)",
                    simple_fed10_p1: "Una 'democracia pura' (donde todos los ciudadanos votan por todo) no puede arreglar el problema de las 'facciones' (grupos que daÃ±an a otros). Si una mayorÃ­a quiere hacer algo malo, no hay nada que les impida lastimar a la minorÃ­a.",
                    simple_fed10_p2: "Una 'repÃºblica' (donde elegimos representantes) es diferente y ofrece una soluciÃ³n. Las dos grandes diferencias son: 1) Damos el trabajo de gobernar a un grupo pequeÃ±o y electo. 2) Una repÃºblica puede funcionar para un paÃ­s mucho mÃ¡s grande con mÃ¡s ciudadanos.",
                    simple_fed39_h: "El Federalista No. 39 (TraducciÃ³n Moderna)",
                    simple_fed39_p1: "Una repÃºblica es un gobierno que obtiene su poder del pueblo, no de un grupo pequeÃ±o o favorecido. Es 'esencial' que el gobierno represente a toda la sociedad. Es 'suficiente' que los lÃ­deres sean elegidos por el pueblo, ya sea directa o indirectamente.",
                    simple_fed51_h: "El Federalista No. 51 (TraducciÃ³n Moderna)",
                    simple_fed51_p1: "Si la gente fuera Ã¡ngeles, no necesitarÃ­amos gobierno. Si los Ã¡ngeles estuvieran a cargo, no necesitarÃ­amos controles sobre ellos. Pero tenemos humanos gobernando a humanos, por lo que el gobierno debe poder controlar al pueblo, y tambiÃ©n debe ser obligado a controlarse a sÃ­ mismo.",
                    simple_fed51_p2: "Las elecciones (depender del pueblo) son el control principal. Pero la experiencia demuestra que tambiÃ©n necesitamos 'precauciones auxiliares' (sistemas de respaldo). Debemos usar la ambiciÃ³n para frenar la ambiciÃ³n, conectando los intereses personales de un lÃ­der con sus deberes oficiales.",
                    // Tools
                    toggle_tools: "Herramientas de Accesibilidad ğŸ› ï¸",
                    read_aloud: "Hablar ğŸ—£ï¸",
                    high_contrast: "Contraste ğŸŸ¡",
                    focus: "Enfoque ğŸ‘ï¸",
                    highlighter: "Resaltador highlighter",
                    dark_mode: "Modo Claro â˜€ï¸",
                    fullscreen: "Pantalla Completa"
                },
                ar: {
                    main_title: "Ù…Ø§Ø¯ÙŠØ³ÙˆÙ† ÙˆØ§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ©",
                    tab_questions: "Ø£Ø³Ø¦Ù„Ø© Ø±Ø¦ÙŠØ³ÙŠØ© â“",
                    tab_fed10: "Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 10 ğŸ“œ",
                    tab_fed39: "Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 39 ğŸ›ï¸",
                    tab_fed51: "Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 51 âš–ï¸",
                    // SOCRATIC SEMINAR QUESTIONS
                    socratic_heading: "Ø£Ø³Ø¦Ù„Ø© Ù†Ø¯ÙˆØ© Ø³Ù‚Ø±Ø§Ø·ÙŠØ©",
                    s_q1: "ÙŠØ¨Ø¯Ùˆ Ù…Ø§Ø¯ÙŠØ³ÙˆÙ† Ù‚Ù„Ù‚Ù‹Ø§ Ø¬Ø¯Ù‹Ø§ Ø¨Ø´Ø£Ù† 'Ø§Ù„ÙØµØ§Ø¦Ù„' (Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 10). Ù‡Ù„ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø£Ù† Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø®Ø·Ø± Ø§Ù„Ø£ÙƒØ¨Ø± ÙÙŠ Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ©ØŸ Ù„Ù…Ø§Ø°Ø§ Ø£Ùˆ Ù„Ù…Ø§Ø°Ø§ Ù„Ø§ØŸ",
                    s_q2: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¨ÙŠÙ† 'Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ø¨Ø­ØªØ©' Ùˆ 'Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ©'ØŸ Ù„Ù…Ø§Ø°Ø§ ÙŠØ¹ØªÙ‚Ø¯ Ù…Ø§Ø¯ÙŠØ³ÙˆÙ† Ø£Ù† Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø£ÙƒØ«Ø± Ø£Ù…Ø§Ù†Ù‹Ø§ØŸ (Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 10)",
                    s_q3: "ÙˆÙÙ‚Ù‹Ø§ Ù„Ù…Ø§Ø¯ÙŠØ³ÙˆÙ†ØŒ Ù…Ù† Ø£ÙŠÙ† ØªØ³ØªÙ…Ø¯ Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ø³Ù„Ø·ØªÙ‡Ø§ØŸ (Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 39). ÙƒÙŠÙ ÙŠØ±ØªØ¨Ø· Ù‡Ø°Ø§ Ø¨ÙÙƒØ±Ø© 'Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¹Ø¨'ØŸ (Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 51)",
                    s_q4: "ÙŠÙ‚ÙˆÙ„ Ù…Ø§Ø¯ÙŠØ³ÙˆÙ†: 'Ù„Ùˆ ÙƒØ§Ù† Ø§Ù„Ø±Ø¬Ø§Ù„ Ù…Ù„Ø§Ø¦ÙƒØ©ØŒ Ù„Ù…Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø­Ø§Ø¬Ø© Ø¥Ù„Ù‰ Ø­ÙƒÙˆÙ…Ø©' (Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 51). Ù…Ø§Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø¨Ù‡Ø°Ø§ØŸ ÙƒÙŠÙ ØªØ¨Ø±Ø± Ù‡Ø°Ù‡ Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„Ø­Ø§Ø¬Ø© Ø¥Ù„Ù‰ 'Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©'ØŸ",
                    s_q5: "Ù‡Ù„ ÙŠÙ…ÙƒÙ† 'Ù„Ù„Ø·Ù…ÙˆØ­... Ø£Ù† ÙŠÙˆØ§Ø¬Ù‡ Ø§Ù„Ø·Ù…ÙˆØ­' (Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 51)ØŸ Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙÙƒÙŠØ± ÙÙŠ Ù…Ø«Ø§Ù„ Ø­Ø¯ÙŠØ« Ø­ÙŠØ« ÙŠÙ‚ÙˆÙ… Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø­ÙƒÙˆÙ…Ø© (Ø£Ùˆ Ø´Ø®Øµ ÙˆØ§Ø­Ø¯) 'Ø¨Ù…Ø±Ø§Ù‚Ø¨Ø©' Ø¬Ø²Ø¡ Ø¢Ø®Ø±ØŸ",
                    s_q6: "Ù‡Ù„ Ù†Ø¸Ø§Ù… Ù…Ø§Ø¯ÙŠØ³ÙˆÙ† Ù„Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„ÙƒØ¨ÙŠØ±Ø© (Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 10) Ùˆ 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©' (Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 51) ÙƒØ§ÙÙ Ù„Ø­Ù…Ø§ÙŠØ© Ø­Ù‚ÙˆÙ‚ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£Ù‚Ù„ÙŠØ©ØŸ Ù…ØªÙ‰ Ù‚Ø¯ ÙŠÙØ´Ù„ØŸ",
                    // END SOCRATIC
                    show_main_idea: "Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
                    // Main Idea Text
                    idea_fed10: "Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø£ÙØ¶Ù„ Ù…Ù† Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„ØµØºÙŠØ±Ø© ÙÙŠ Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªÙŠ ØªØ³Ø¨Ø¨Ù‡Ø§ 'Ø§Ù„ÙØµØ§Ø¦Ù„' (Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ† Ø°ÙˆÙŠ Ù…ØµÙ„Ø­Ø© Ù…Ø´ØªØ±ÙƒØ©).",
                    idea_fed39: "Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ù‡ÙŠ Ø­ÙƒÙˆÙ…Ø© ØªØ³ØªÙ…Ø¯ Ø³Ù„Ø·ØªÙ‡Ø§ Ù…Ù† Ø§Ù„Ø´Ø¹Ø¨ØŒ ÙˆÙ„ÙŠØ³ Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹Ø© ØµØºÙŠØ±Ø© Ø£Ùˆ 'Ù…Ø­Ø¸ÙŠØ©'.",
                    idea_fed51: "Ù†Ø¸Ø±Ù‹Ø§ Ù„Ø£Ù† Ø§Ù„Ù†Ø§Ø³ Ù„ÙŠØ³ÙˆØ§ Ù…Ù„Ø§Ø¦ÙƒØ©ØŒ ÙŠØ¬Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ù…Ø¹ 'Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©' (Ø¶ÙˆØ§Ø¨Ø· ÙˆØªÙˆØ§Ø²Ù†Ø§Øª) Ù„ØªØ³ÙŠØ·Ø± Ø¹Ù„Ù‰ Ù†ÙØ³Ù‡Ø§.",
                    idea_title_fed10: "Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©: Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 10",
                    idea_title_fed39: "Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©: Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 39",
                    idea_title_fed51: "Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©: Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 51",
                    // *** NEW: Modern Translation Keys ***
                    show_translation: "Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø© ğŸ“–",
                    show_original: "Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ ğŸ“œ",
                    simple_fed10_h: "Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ Ø±Ù‚Ù… 10 (ØªØ±Ø¬Ù…Ø© Ø­Ø¯ÙŠØ«Ø©)",
                    simple_fed10_p1: "Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ø¨Ø­ØªØ©' (Ø­ÙŠØ« ÙŠØµÙˆØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ† Ø¹Ù„Ù‰ ÙƒÙ„ Ø´ÙŠØ¡) Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡Ø§ Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© 'Ø§Ù„ÙØµØ§Ø¦Ù„' (Ø§Ù„Ø¬Ù…Ø§Ø¹Ø§Øª Ø§Ù„ØªÙŠ ØªØ¤Ø°ÙŠ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†). Ø¥Ø°Ø§ Ø£Ø±Ø§Ø¯Øª Ø§Ù„Ø£ØºÙ„Ø¨ÙŠØ© Ø§Ù„Ù‚ÙŠØ§Ù… Ø¨Ø´ÙŠØ¡ Ø³ÙŠØ¡ØŒ ÙÙ„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø§ ÙŠÙ…Ù†Ø¹Ù‡Ø§ Ù…Ù† Ø¥ÙŠØ°Ø§Ø¡ Ø§Ù„Ø£Ù‚Ù„ÙŠØ©.",
                    simple_fed10_p2: "Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ©' (Ø­ÙŠØ« Ù†Ù†ØªØ®Ø¨ Ù…Ù…Ø«Ù„ÙŠÙ†) Ù…Ø®ØªÙ„ÙØ© ÙˆØªÙ‚Ø¯Ù… Ø­Ù„Ø§Ù‹. Ø§Ù„ÙØ±ÙˆÙ‚Ø§Ù† Ø§Ù„ÙƒØ¨ÙŠØ±Ø§Ù† Ù‡Ù…Ø§: 1) Ù†Ø¹Ø·ÙŠ Ù…Ù‡Ù…Ø© Ø§Ù„Ø­ÙƒÙ… Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ØµØºÙŠØ±Ø© Ù…Ù†ØªØ®Ø¨Ø©. 2) ÙŠÙ…ÙƒÙ† Ù„Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø£Ù† ØªØ¹Ù…Ù„ ÙÙŠ Ø¨Ù„Ø¯ Ø£ÙƒØ¨Ø± Ø¨ÙƒØ«ÙŠØ± Ù…Ø¹ Ø¹Ø¯Ø¯ Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ†.",
                    simple_fed39_h: "Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ Ø±Ù‚Ù… 39 (ØªØ±Ø¬Ù…Ø© Ø­Ø¯ÙŠØ«Ø©)",
                    simple_fed39_p1: "Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ù‡ÙŠ Ø­ÙƒÙˆÙ…Ø© ØªØ³ØªÙ…Ø¯ Ø³Ù„Ø·ØªÙ‡Ø§ Ù…Ù† Ø§Ù„Ø´Ø¹Ø¨ØŒ ÙˆÙ„ÙŠØ³ Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹Ø© ØµØºÙŠØ±Ø© Ø£Ùˆ Ù…ÙØ¶Ù„Ø©. Ù…Ù† 'Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ' Ø£Ù† ØªÙ…Ø«Ù„ Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø¨Ø£ÙƒÙ…Ù„Ù‡. ÙˆÙŠÙƒÙÙŠ Ø£Ù† ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§Ø¯Ø© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø´Ø¹Ø¨ØŒ Ø³ÙˆØ§Ø¡ Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø± Ø£Ùˆ ØºÙŠØ± Ù…Ø¨Ø§Ø´Ø±.",
                    simple_fed51_h: "Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ Ø±Ù‚Ù… 51 (ØªØ±Ø¬Ù…Ø© Ø­Ø¯ÙŠØ«Ø©)",
                    simple_fed51_p1: "Ù„Ùˆ ÙƒØ§Ù† Ø§Ù„Ù†Ø§Ø³ Ù…Ù„Ø§Ø¦ÙƒØ©ØŒ Ù„Ù…Ø§ Ø§Ø­ØªØ¬Ù†Ø§ Ø¥Ù„Ù‰ Ø­ÙƒÙˆÙ…Ø©. ÙˆÙ„Ùˆ ÙƒØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø¦ÙƒØ© Ù‡Ù… Ø§Ù„Ø­ÙƒØ§Ù…ØŒ Ù„Ù…Ø§ Ø§Ø­ØªØ¬Ù†Ø§ Ø¥Ù„Ù‰ Ø¶ÙˆØ§Ø¨Ø· Ø¹Ù„ÙŠÙ‡Ù…. Ù„ÙƒÙ† Ù„Ø¯ÙŠÙ†Ø§ Ø¨Ø´Ø± ÙŠØ­ÙƒÙ…ÙˆÙ† Ø¨Ø´Ø±Ø§Ù‹ØŒ Ù„Ø°Ø§ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ù‚Ø§Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø§Ø³ØŒ ÙˆÙŠØ¬Ø¨ Ø£ÙŠØ¶Ø§Ù‹ Ø¥Ø¬Ø¨Ø§Ø±Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø¹Ù„Ù‰ Ù†ÙØ³Ù‡Ø§.",
                    simple_fed51_p2: "Ø§Ù„Ø§Ù†ØªØ®Ø§Ø¨Ø§Øª (Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¹Ø¨) Ù‡ÙŠ Ø§Ù„Ø¶Ø§Ø¨Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ. Ù„ÙƒÙ† Ø§Ù„ØªØ¬Ø±Ø¨Ø© ØªØ¸Ù‡Ø± Ø£Ù†Ù†Ø§ Ø¨Ø­Ø§Ø¬Ø© Ø£ÙŠØ¶Ø§Ù‹ Ø¥Ù„Ù‰ 'Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©' (Ø£Ù†Ø¸Ù…Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©). ÙŠØ¬Ø¨ Ø£Ù† Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø·Ù…ÙˆØ­ Ù„ÙƒØ¨Ø­ Ø§Ù„Ø·Ù…ÙˆØ­ØŒ ÙˆØ±Ø¨Ø· Ø§Ù„Ù…ØµØ§Ù„Ø­ Ø§Ù„Ø´Ø®ØµÙŠØ© Ù„Ù„Ù‚Ø§Ø¦Ø¯ Ø¨ÙˆØ§Ø¬Ø¨Ø§ØªÙ‡ Ø§Ù„Ø±Ø³Ù…ÙŠØ©.",
                    // Tools
                    toggle_tools: "Ø£Ø¯ÙˆØ§Øª Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ ğŸ› ï¸",
                    read_aloud: "ØªØ­Ø¯Ø« ğŸ—£ï¸",
                    high_contrast: "ØªØ¨Ø§ÙŠÙ† ğŸŸ¡",
                    focus: "ØªØ±ÙƒÙŠØ² ğŸ‘ï¸",
                    highlighter: "Ø£Ø¯Ø§Ø© Ø§Ù„ØªÙ…ÙŠÙŠØ² highlighter",
                    dark_mode: "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ â˜€ï¸",
                    fullscreen: "Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©"
                }
            };
            
            // --- Simplifier (Modal) Data ---
            const definitions = {
                en: {
                    pure_democracy: "A 'pure democracy' (or direct democracy) is a system where all citizens vote directly on every law, rather than electing representatives.",
                    mischiefs_faction: "The 'mischiefs of faction' are the dangers and problems caused by groups of citizens (factions) who unite to push for goals that ignore the rights of other citizens or the good of the whole country.",
                    republic: "A 'republic' is a form of government where citizens elect representatives to make laws and decisions for them.",
                    great_body: "The 'great body of the people' means the entire population or the vast majority of citizens, not just a small, wealthy, or 'favored' group.",
                    auxiliary_precautions: "'Auxiliary precautions' are the backup systems to control government, like the separation of powers and checks and balances, which are needed in addition to the 'primary control' of elections.",
                    faction: "A 'faction' is a group of citizens (either a majority or minority) who are united by a common interest or passion that is against the rights of other citizens or the good of the whole community.",
                    representation: "The 'scheme of representation' is the system where citizens elect a smaller group of people to make laws and govern on their behalf.",
                    favored_class: "A 'favored class' refers to a privileged group, like an aristocracy or nobility, who might try to rule for their own benefit instead of for the benefit of all citizens.",
                    dependence_people: "A 'dependence on the people' refers to the government's need to be accountable to the voters through regular and free elections. Madison called this the 'primary control' on government.",
                    internal_controls: "'Internal controls' are the mechanisms within the government structure that oblige it to control itself, such as the separation of powers between the legislative, executive, and judicial branches."
                },
                es: {
                    pure_democracy: "Una 'democracia pura' (o democracia directa) es un sistema donde todos los ciudadanos votan directamente sobre cada ley, en lugar de elegir representantes.",
                    mischiefs_faction: "Los 'males de facciÃ³n' son los peligros y problemas causados por grupos de ciudadanos (facciones) que se unen para impulsar objetivos que ignoran los derechos de otros ciudadanos o el bien de todo el paÃ­s.",
                    republic: "Una 'repÃºblica' es una forma de gobierno donde los ciudadanos eligen representantes para que tomen leyes y decisiones por ellos.",
                    great_body: "El 'gran cuerpo del pueblo' significa la poblaciÃ³n entera o la gran mayorÃ­a de los ciudadanos, no solo un grupo pequeÃ±o, rico o 'favorecido'.",
                    auxiliary_precautions: "Las 'precauciones auxiliares' son los sistemas de respaldo para controlar al gobierno, como la separaciÃ³n de poderes y los controles y equilibrios, que se necesitan ademÃ¡s del 'control primario' de las elecciones.",
                    faction: "Una 'facciÃ³n' es un grupo de ciudadanos (ya sea una mayorÃ­a o minorÃ­a) que estÃ¡n unidos por un interÃ©s o pasiÃ³n comÃºn que va en contra de los derechos de otros citizens o del bien de toda la comunidad.",
                    representation: "El 'esquema de representaciÃ³n' es el sistema donde los ciudadanos eligen a un grupo mÃ¡s pequeÃ±o de personas para que hagan leyes y gobiernen en su nombre.",
                    favored_class: "Una 'clase favorecida' se refiere a un grupo privilegiado, como una aristocracia o nobleza, que podrÃ­a intentar gobernar para su propio beneficio en lugar de para el beneficio de todos los ciudadanos.",
                    dependence_people: "Una 'dependencia del pueblo' se refiere a la necesidad del gobierno de rendir cuentas a los votantes a travÃ©s de elecciones regulares y libres. Madison llamÃ³ a esto el 'control primario' sobre el gobierno.",
                    internal_controls: "Los 'controles internos' son los mecanismos dentro de la estructura del gobierno que lo obligan a controlarse a sÃ­ mismo, como la separaciÃ³n de poderes entre las ramas legislativa, ejecutiva y judicial."
                },
                ar: {
                    pure_democracy: "Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ø¨Ø­ØªØ©' (Ø£Ùˆ Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©) Ù‡ÙŠ Ù†Ø¸Ø§Ù… ÙŠØµÙˆØª ÙÙŠÙ‡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ† Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ ÙƒÙ„ Ù‚Ø§Ù†ÙˆÙ†ØŒ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù…Ø«Ù„ÙŠÙ†.",
                    mischiefs_faction: "'Ø¢ÙØ§Øª Ø§Ù„ÙØµÙŠÙ„' Ù‡ÙŠ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªÙŠ ØªØ³Ø¨Ø¨Ù‡Ø§ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ† (Ø§Ù„ÙØµØ§Ø¦Ù„) Ø§Ù„Ø°ÙŠÙ† ÙŠØªØ­Ø¯ÙˆÙ† Ù„Ù„Ø¯ÙØ¹ Ø¨Ø£Ù‡Ø¯Ø§Ù ØªØªØ¬Ø§Ù‡Ù„ Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ø£Ùˆ Ù…ØµÙ„Ø­Ø© Ø§Ù„Ø¨Ù„Ø¯ Ø¨Ø£ÙƒÙ…Ù„Ù‡.",
                    republic: "Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ©' Ù‡ÙŠ Ø´ÙƒÙ„ Ù…Ù† Ø£Ø´ÙƒØ§Ù„ Ø§Ù„Ø­ÙƒÙ… ÙŠÙ†ØªØ®Ø¨ ÙÙŠÙ‡ Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙˆÙ† Ù…Ù…Ø«Ù„ÙŠÙ† Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† ÙˆØ§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ù†ÙŠØ§Ø¨Ø© Ø¹Ù†Ù‡Ù….",
                    great_body: "'Ø§Ù„Ø¬Ø³Ù… Ø§Ù„Ø¹Ø¸ÙŠÙ… Ù„Ù„Ø´Ø¹Ø¨' ÙŠØ¹Ù†ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³ÙƒØ§Ù† Ø£Ùˆ Ø§Ù„Ø£ØºÙ„Ø¨ÙŠØ© Ø§Ù„Ø³Ø§Ø­Ù‚Ø© Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ†ØŒ ÙˆÙ„ÙŠØ³ Ù…Ø¬Ø±Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ø© ØµØºÙŠØ±Ø© Ø£Ùˆ ØºÙ†ÙŠØ© Ø£Ùˆ 'Ù…Ø­Ø¸ÙŠØ©'.",
                    auxiliary_precautions: "'Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©' Ù‡ÙŠ Ø£Ù†Ø¸Ù…Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„Ø³ÙŠØ·Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø­ÙƒÙˆÙ…Ø©ØŒ Ù…Ø«Ù„ ÙØµÙ„ Ø§Ù„Ø³Ù„Ø·Ø§Øª ÙˆØ§Ù„Ø¶ÙˆØ§Ø¨Ø· ÙˆØ§Ù„ØªÙˆØ§Ø²Ù†Ø§ØªØŒ ÙˆØ§Ù„ØªÙŠ ØªØ¯Ø¹Ùˆ Ø§Ù„Ø­Ø§Ø¬Ø© Ø¥Ù„ÙŠÙ‡Ø§ Ø¨Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ 'Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©' Ù„Ù„Ø§Ù†ØªØ®Ø§Ø¨Ø§Øª.",
                    faction: "'Ø§Ù„ÙØµÙŠÙ„' Ù‡Ùˆ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ† (Ø³ÙˆØ§Ø¡ ÙƒØ§Ù†Øª Ø£ØºÙ„Ø¨ÙŠØ© Ø£Ùˆ Ø£Ù‚Ù„ÙŠØ©) Ù…ØªØ­Ø¯ÙˆÙ† Ø¨Ù…ØµÙ„Ø­Ø© Ø£Ùˆ Ø´ØºÙ Ù…Ø´ØªØ±Ùƒ ÙŠØªØ¹Ø§Ø±Ø¶ Ù…Ø¹ Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ø£Ùˆ Ù…ØµÙ„Ø­Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø¨Ø£Ø³Ø±Ù‡.",
                    representation: "'Ù…Ø®Ø·Ø· Ø§Ù„ØªÙ…Ø«ÙŠÙ„' Ù‡Ùˆ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙŠ ÙŠÙ†ØªØ®Ø¨ ÙÙŠÙ‡ Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙˆÙ† Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£ØµØºØ± Ù…Ù† Ø§Ù„Ø£Ø´Ø®Ø§Øµ Ù„Ø³Ù† Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† ÙˆØ§Ù„Ø­ÙƒÙ… Ù†ÙŠØ§Ø¨Ø© Ø¹Ù†Ù‡Ù….",
                    favored_class: "ØªØ´ÙŠØ± 'Ø§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ù…Ø­Ø¸ÙŠØ©' Ø¥Ù„Ù‰ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…ØªÙ…ÙŠØ²Ø©ØŒ Ù…Ø«Ù„ Ø§Ù„Ø£Ø±Ø³ØªÙ‚Ø±Ø§Ø·ÙŠØ© Ø£Ùˆ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ØŒ Ù‚Ø¯ ØªØ­Ø§ÙˆÙ„ Ø§Ù„Ø­ÙƒÙ… Ù„ØµØ§Ù„Ø­Ù‡Ø§ Ø§Ù„Ø®Ø§Øµ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† ØµØ§Ù„Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ†.",
                    dependence_people: "ÙŠØ´ÙŠØ± 'Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¹Ø¨' Ø¥Ù„Ù‰ Ø­Ø§Ø¬Ø© Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ù„Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø³Ø¤ÙˆÙ„Ø© Ø£Ù…Ø§Ù… Ø§Ù„Ù†Ø§Ø®Ø¨ÙŠÙ† Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù†ØªØ®Ø§Ø¨Ø§Øª Ù…Ù†ØªØ¸Ù…Ø© ÙˆØ­Ø±Ø©. ÙˆØµÙ Ù…Ø§Ø¯ÙŠØ³ÙˆÙ† Ù‡Ø°Ø§ Ø¨Ø£Ù†Ù‡ 'Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©' Ø¹Ù„Ù‰ Ø§Ù„Ø­ÙƒÙˆÙ…Ø©.",
                    internal_controls: "'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©' Ù‡ÙŠ Ø§Ù„Ø¢Ù„ÙŠØ§Øª Ø¯Ø§Ø®Ù„ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ø§Ù„ØªÙŠ ØªØ¬Ø¨Ø±Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø¹Ù„Ù‰ Ù†ÙØ³Ù‡Ø§ØŒ Ù…Ø«Ù„ ÙØµÙ„ Ø§Ù„Ø³Ù„Ø·Ø§Øª Ø¨ÙŠÙ† Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„ØªØ´Ø±ÙŠØ¹ÙŠØ© ÙˆØ§Ù„ØªÙ†ÙÙŠØ°ÙŠØ© ÙˆØ§Ù„Ù‚Ø¶Ø§Ø¦ÙŠØ©."
                }
            };
            
            // --- Function to update all text content based on currentLang ---
            function updateLanguage(lang) {
                currentLang = lang;
                document.documentElement.lang = lang;
                document.documentElement.dir = (lang === 'ar') ? 'rtl' : 'ltr';

                // Update all elements with a data-key
                document.querySelectorAll('[data-key]').forEach(el => {
                    const key = el.getAttribute('data-key');
                    if (translations[lang] && translations[lang][key]) {
                        el.textContent = translations[lang][key];
                    }
                });
                
                // Update language switcher active state
                document.querySelectorAll('.lang-select').forEach(btn => {
                    if (btn.getAttribute('data-lang') === lang) {
                        btn.classList.add('font-bold');
                        btn.classList.remove('text-gray-500', 'dark:text-gray-400');
                    } else {
                        btn.classList.remove('font-bold');
                        btn.classList.add('text-gray-500', 'dark:text-gray-400');
                    }
                });
            }

            // --- Language Switcher Event Listeners ---
            document.querySelectorAll('.lang-select').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    updateLanguage(e.currentTarget.getAttribute('data-lang'));
                });
            });

            // --- Tab Switching Logic ---
            tabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    // Get the target tab from data-tab attribute
                    const targetTab = e.currentTarget.getAttribute('data-tab');
                    activeTab = targetTab; // Update active tab

                    // Deactivate all tabs and hide all content
                    tabs.forEach(t => t.classList.remove('active'));
                    contents.forEach(c => c.classList.add('hidden'));

                    // Activate the clicked tab and show its content
                    e.currentTarget.classList.add('active');
                    document.getElementById(targetTab).classList.remove('hidden');
                });
            });

            // --- Modal (Simplifier) Logic ---
            const modal = document.getElementById('modal');
            const modalTerm = document.getElementById('modal-term');
            const modalDefinition = document.getElementById('modal-definition');
            const modalClose = document.getElementById('modal-close');

            // This is for arbitrary text, like the "Main Idea"
            function openSimpleModal(title, text) {
                modalTerm.textContent = title || "Error";
                modalDefinition.textContent = text || "Could not find text.";
                modal.classList.remove('hidden');
            }

            // This is the original function for the blue links
            function openModal(term) {
                if (definitions[currentLang] && definitions[currentLang][term]) {
                    modalTerm.textContent = term.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    modalDefinition.textContent = definitions[currentLang][term];
                    modal.classList.remove('hidden');
                }
            }

            function closeModal() {
                modal.classList.add('hidden');
                modalTerm.textContent = "";
                modalDefinition.textContent = "";
            }
            
            // --- "Show Main Idea" Button Logic ---
            document.querySelectorAll('.show-main-idea-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent click from bubbling
                    const ideaKey = e.currentTarget.getAttribute('data-idea'); // 'idea_fed10'
                    const text = translations[currentLang][ideaKey];
                    
                    let titleKey = "show_main_idea"; // A generic fallback
                    if (ideaKey === 'idea_fed10') titleKey = "idea_title_fed10";
                    if (ideaKey === 'idea_fed39') titleKey = "idea_title_fed39";
                    if (ideaKey === 'idea_fed51') titleKey = "idea_title_fed51";
                    
                    const title = translations[currentLang][titleKey];
                    
                    openSimpleModal(title, text);
                });
            });


            // --- Simplifier Links Event Listeners ---
            document.querySelectorAll('.simplifier').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation(); // Stop click from bubbling to highlighter
                    const term = e.currentTarget.getAttribute('data-term');
                    openModal(term);
                });
            });

            modalClose.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });

            // --- *** NEW: Modern Translation Toggle Logic *** ---
            document.querySelectorAll('.simplify-toggle-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const docId = e.currentTarget.getAttribute('data-doc');
                    const contentRoot = document.getElementById(docId);
                    const originalText = contentRoot.querySelector('.doc-original');
                    const simplifiedText = contentRoot.querySelector('.doc-simplified');
                    const buttonSpan = e.currentTarget.querySelector('span');

                    // Toggle visibility
                    originalText.classList.toggle('hidden');
                    simplifiedText.classList.toggle('hidden');

                    // Toggle button text
                    if (originalText.classList.contains('hidden')) {
                        // We are showing simplified, so button should say "Show Original"
                        buttonSpan.textContent = translations[currentLang]['show_original'];
                        buttonSpan.setAttribute('data-key', 'show_original');
                    } else {
                        // We are showing original, so button should say "Show Modern Translation"
                        buttonSpan.textContent = translations[currentLang]['show_translation'];
                        buttonSpan.setAttribute('data-key', 'show_translation');
                    }
                });
            });
            // --- *** END OF NEW LOGIC *** ---


            // --- Accessibility: Toggle Tools Panel ---
            const toolsHeader = document.getElementById('tools-header');
            const toolsPanel = document.getElementById('tools-panel');
            toolsHeader.addEventListener('click', () => {
                toolsPanel.classList.toggle('hidden');
                toolsHeader.querySelector('button').classList.toggle('bg-gray-300');
                toolsHeader.querySelector('button').classList.toggle('dark:bg-gray-800');
            });
            
            // --- Accessibility: Text-to-Speech ---
            const readAloudBtn = document.getElementById('read-aloud');
            const synth = window.speechSynthesis;

            function speakText(text) {
                if (synth.speaking) {
                    synth.cancel(); // Stop any current speech
                    return;
                }
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = currentLang === 'ar' ? 'ar-SA' : (currentLang === 'es' ? 'es-ES' : 'en-US');
                synth.speak(utterance);
            }

            readAloudBtn.addEventListener('click', (e) => {
                let textToSpeak = '';
                const activeContent = document.getElementById(activeTab);
                if (activeContent) {
                    // Check which text is visible: simplified or original
                    const simpleText = activeContent.querySelector('.doc-simplified:not(.hidden)');
                    const originalText = activeContent.querySelector('.doc-original:not(.hidden)');
                    
                    if (simpleText) {
                        textToSpeak = simpleText.textContent;
                    } else if (originalText) {
                        textToSpeak = originalText.textContent;
                    } else {
                         // Fallback for non-doc tabs like "Key Questions"
                        const docText = activeContent.querySelector('.doc-text');
                        textToSpeak = (docText || activeContent).textContent;
                    }
                }
                speakText(textToSpeak.trim());
            });

            // --- Accessibility: High Contrast & Dark/Light Mode Toggles ---
            const contrastToggle = document.getElementById('contrast-toggle');
            const lightModeToggle = document.getElementById('light-mode-toggle');

            contrastToggle.addEventListener('click', (e) => {
                appContainer.classList.toggle('high-contrast');
                e.currentTarget.classList.toggle('active-toggle');
                
                if (appContainer.classList.contains('high-contrast')) {
                    document.documentElement.classList.add('dark'); 
                    lightModeToggle.classList.add('active-toggle');
                }
            });
            
            lightModeToggle.addEventListener('click', (e) => {
                document.documentElement.classList.toggle('dark');
                e.currentTarget.classList.toggle('active-toggle');

                if (!document.documentElement.classList.contains('dark')) { 
                    appContainer.classList.remove('high-contrast');
                    contrastToggle.classList.remove('active-toggle');
                }
            });

            // --- Accessibility: Reading Ruler ---
            const rulerToggle = document.getElementById('ruler-toggle');
            const ruler = document.getElementById('reading-ruler');

            rulerToggle.addEventListener('click', (e) => {
                e.currentTarget.classList.toggle('active-toggle');
                ruler.style.display = (ruler.style.display === 'block') ? 'none' : 'block';
            });

            document.addEventListener('mousemove', (e) => {
                if (ruler.style.display === 'block') {
                    ruler.style.transform = `translateY(${e.clientY - (ruler.offsetHeight / 2)}px)`;
                }
            });
            
            // --- Accessibility: Highlighter ---
            const highlighterToggle = document.getElementById('highlighter-toggle');
            let highlighterEnabled = false;

            highlighterToggle.addEventListener('click', (e) => {
                highlighterEnabled = !highlighterEnabled;
                e.currentTarget.classList.toggle('active-toggle');
            });
            
            appContainer.addEventListener('click', (e) => {
                if (!highlighterEnabled) return;
                if (!e.target.closest('.doc-text')) return;
                if (e.target.classList.contains('simplifier')) {
                    return;
                }
                
                if (e.target.classList.contains('highlight')) {
                    const parent = e.target.parentNode;
                    parent.replaceChild(document.createTextNode(e.target.textContent), e.target);
                    parent.normalize(); 
                    return;
                }

                const selection = window.getSelection();
                if (selection.rangeCount > 0 && !selection.isCollapsed) {
                    const range = selection.getRangeAt(0);
                    
                    if (!range.startContainer.parentElement.closest('.doc-text')) return;

                    const span = document.createElement('span');
                    span.className = 'highlight';
                    
                    try {
                        range.surroundContents(span);
                    } catch (ex) {
                        console.warn("Could not wrap selection, likely spans across elements.", ex);
                    }
                    
                    selection.removeAllRanges(); 
                }
            });


            // --- Accessibility: Full Screen ---
            const fullscreenToggle = document.getElementById('fullscreen-toggle');
            fullscreenToggle.addEventListener('click', (e) => {
                e.currentTarget.classList.toggle('active-toggle');
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen.call(document);
                    }
                }
            });
            
            document.addEventListener('fullscreenchange', () => {
                if (!document.fullscreenElement) {
                    fullscreenToggle.classList.remove('active-toggle');
                }
            });

            // --- Initial Setup ---
            updateLanguage('en'); // Set default language on load
            lightModeToggle.classList.add('active-toggle');

        });
    </script>
</body>
</html>


<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBQ: Madison and the Republic</title>
    <!-- *** FIX: Corrected Tailwind CSS link *** -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Import Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Base font is now Inter for the whole site */
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* UI elements will use Inter */
        .font-ui {
            font-family: 'Inter', sans-serif;
        }

        /* Base styles for 4K display - large text and touch targets */
        :root {
            --base-font-size: 1.75rem; /* 28px */
            --line-height: 1.7; 
        }

        .content-text {
            font-size: var(--base-font-size);
            line-height: var(--line-height);
            transition: font-size 0.3s;
        }

        /* NEW Highlighter Style */
        .highlight {
            background-color: #fef08a; /* yellow-200 */
            color: #713f12; /* amber-900 */
            border-radius: 4px;
            padding: 0 2px;
            cursor: pointer;
        }

        /* High Contrast Mode */
        .high-contrast {
            background-color: #000;
            color: #FFFF00; /* Yellow text */
        }
        .high-contrast .font-ui {
            color: #FFFF00;
        }
        .high-contrast body, 
        .high-contrast #app-container,
        .high-contrast header,
        .high-contrast footer {
            background-color: #000 !important;
            color: #FFFF00 !important;
        }
        .high-contrast main {
            background-color: #111 !important;
            color: #FFFF00 !important;
        }
        .high-contrast h1, .high-contrast h2, .high-contrast h3, .high-contrast p, .high-contrast span, .high-contrast li {
             color: #FFFF00 !important;
        }
        .high-contrast .tab-btn {
            background-color: #333;
            color: #FFFF00;
            border-color: #FFFF00;
        }
        .high-contrast .tab-btn.active {
            background-color: #FFFF00;
            color: #000;
            border-color: #FFFF00;
        }
        /* Updated to include new small lang button */
        .high-contrast .control-btn, .high-contrast .lang-btn-small {
            background-color: #333 !important;
            color: #FFFF00 !important;
            border-color: #FFFF00 !important;
        }
        .high-contrast .control-btn svg, .high-contrast .lang-btn-small.active {
            fill: #FFFF00;
        }
        .high-contrast .lang-btn-small.active {
            background-color: #FFFF00 !important;
            color: #000 !important;
        }
        .high-contrast .simplifier-term {
            background-color: #FFFF00;
            color: #000;
            padding: 0 4px;
            border-radius: 4px;
        }
        .high-contrast .modal-header {
             background-color: #FFFF00 !important;
             color: #000 !important;
        }
         .high-contrast .modal-header h3 {
             color: #000 !important;
         }
        .high-contrast .modal-body {
            background-color: #111;
            color: #FFFF00;
            border: 2px solid #FFFF00;
        }
        .high-contrast .modal-close {
            color: #000 !important;
        }
        .high-contrast .modal-close:hover {
            color: #333 !important;
        }
        .high-contrast #reading-ruler {
            background-color: rgba(255, 255, 0, 0.4);
            border-top: 2px solid #FFFF00;
            border-bottom: 2px solid #FFFF00;
        }
        .high-contrast .main-idea-btn {
            background-color: #333 !important;
            color: #FFFF00 !important;
            border-color: #FFFF00 !important;
        }
         .high-contrast .main-idea-btn svg {
             fill: #FFFF00;
         }
        .high-contrast .main-idea-content {
            background-color: #222 !important;
            border-color: #FFFF00 !important;
            color: #FFFF00 !important;
        }
        .high-contrast #tools-toggle-btn {
            background-color: #222 !important;
            color: #FFFF00 !important;
        }
        .high-contrast #tools-panel {
            background-color: #111 !important;
            border-color: #FFFF00 !important;
        }
        /* NEW High Contrast Highlighter */
        .high-contrast .highlight {
            background-color: #00FFFF; /* Cyan */
            color: #000; /* Black */
        }
        /* NEW High Contrast Notes Textarea */
        .high-contrast #notes-textarea {
            background-color: #222;
            color: #FFFF00;
            border-color: #FFFF00;
        }

        /* Simplifier Term - New Theme */
        .simplifier-term {
            background-color: #dbeafe; /* blue-100 */
            color: #1e40af; /* blue-800 */
            padding: 0 6px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500; /* Lighter weight for sans-serif */
            transition: all 0.2s;
            white-space: nowrap;
        }
        .simplifier-term:hover {
            background-color: #bfdbfe; /* blue-200 */
        }
        
        /* Tab Styles - More inconspicuous */
        .tab-btn {
            transition: all 0.2s;
            border-bottom-width: 2px; /* Thinner border */
            border-color: transparent;
            color: #6b7280; /* gray-500 */
            font-size: 1.25rem; /* 20px */
            padding: 0.75rem 1rem;
        }
        @media (min-width: 768px) {
            .tab-btn {
                font-size: 1.5rem; /* 24px */
                padding: 0.75rem 1.5rem;
            }
        }
        .tab-btn.active {
            border-color: #2563eb; /* blue-600 */
            color: #2563eb; /* blue-600 */
            font-weight: 600;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        /* Modal Styles - New Theme */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
            align-items: center;
            justify-content: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-container {
            margin: auto;
            width: 90%;
            max-width: 1000px;
            border-radius: 12px;
            overflow: hidden; /* To keep rounded corners */
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2rem 3rem;
        }
        .modal-body {
            padding: 3rem;
        }
        .modal-close {
            transition: color 0.2s, transform 0.2s;
            transform: scale(1);
        }
        .modal-close:hover {
            color: #9ca3af; /* gray-400 */
            transform: scale(1.1);
        }

        /* Reading Ruler */
        #reading-ruler {
            display: none;
            position: fixed;
            width: 100%;
            height: 5rem; /* Taller for smartboard touch */
            background-color: rgba(0, 80, 180, 0.25);
            border-top: 2px solid rgba(0, 80, 180, 0.5);
            border-bottom: 2px solid rgba(0, 80, 180, 0.5);
            z-index: 50;
            pointer-events: none; /* Allows clicking through it */
            top: 50%;
            left: 0;
            transform: translateY(-50%);
        }
        #reading-ruler.active {
            display: block;
        }
        
        /* Main Idea Button/Content - New Theme */
        .main-idea-btn {
            border: 2px solid #2563eb; /* blue-600 */
            color: #2563eb; /* blue-600 */
            transition: all 0.2s;
        }
        .main-idea-btn:hover {
            background-color: #eff6ff; /* blue-50 */
        }
         .main-idea-btn svg {
             fill: #2563eb; /* blue-600 */
         }
        .main-idea-content {
            background-color: #eff6ff; /* blue-50 */
            border-left: 4px solid #2563eb; /* blue-600 */
            color: #1e3a8a; /* blue-800 */
        }
        
        /* Control Button Base Style */
        .control-btn {
            background-color: #ffffff;
            color: #374151; /* gray-700 */
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }
        .control-btn:hover {
            background-color: #f9fafb; /* gray-50 */
            border-color: #9ca3af; /* gray-400 */
        }
        .control-btn.active-toggle {
            background-color: #2563eb; /* blue-600 */
            color: #ffffff;
            border-color: #2563eb; /* blue-600 */
        }
        .control-btn.active-toggle svg {
            fill: #ffffff;
        }
        .control-btn svg {
            fill: #374151; /* gray-700 */
            transition: fill 0.2s;
        }
        /* NEW Notes Textarea Style */
        #notes-textarea {
            width: 100%;
            height: 60vh; /* 60% of viewport height */
            border: 2px solid #d1d5db; /* gray-300 */
            border-radius: 12px;
            padding: 1.5rem;
            font-size: 1.5rem; /* 24px */
            line-height: 1.6;
            resize: vertical; /* Allow vertical resizing */
        }
        #notes-textarea:focus {
            outline: none;
            border-color: #2563eb; /* blue-600 */
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }

        /* NEW Language Switcher (small) */
        .lang-btn-small {
            background-color: #f3f4f6; /* gray-100 */
            color: #4b5563; /* gray-600 */
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 8px;
            padding: 0.5rem 0.75rem;
            font-size: 1rem; /* 16px */
            font-weight: 500;
            transition: all 0.2s;
        }
        .lang-btn-small:hover {
            background-color: #e5e7eb; /* gray-200 */
        }
        .lang-btn-small.active {
            background-color: #2563eb; /* blue-600 */
            color: #ffffff;
            border-color: #2563eb; /* blue-600 */
        }

        /* RTL Specific Styles */
        [dir="rtl"] {
            direction: rtl;
        }
        [dir="rtl"] .tab-nav {
            flex-direction: row-reverse;
        }
        [dir="rtl"] .main-idea-content {
            border-left: none;
            border-right: 4px solid #2563eb; /* blue-600 */
        }
        [dir="rtl"] .question-section p {
            border-left: none;
            border-right: 4px solid #e5e7eb; /* gray-200 */
            padding-left: 0;
            padding-right: 1rem;
        }
        [dir="rtl"] .question-section ul {
            padding-left: 0;
            padding-right: 2rem;
        }
        [dir="rtl"] .modal-header, [dir="rtl"] .modal-body {
            text-align: right;
        }
        [dir="rtl"] .modal-header {
            flex-direction: row-reverse;
        }
        /* Position new lang switcher for RTL */
        [dir="rtl"] .lang-switcher {
            right: auto;
            left: 1rem; /* 16px */
        }
        @media (min-width: 768px) {
            [dir="rtl"] .lang-switcher {
                right: auto;
                left: 2rem; /* 32px */
            }
        }
    </style>
</head>
<!-- New Theme: Light gray background, dark gray text -->
<body class="bg-gray-100 text-gray-900">

    <!-- Reading Ruler element -->
    <div id="reading-ruler"></div>

    <div id="app-container" class="min-h-screen p-6 md:p-12">
        <!-- Header -->
        <header class="relative text-center mb-8 font-ui"> <!-- Added relative positioning -->
            <!-- NEW inconspicuous Language Switcher -->
            <div class="lang-switcher absolute top-0 right-4 md:top-2 md:right-8 flex gap-2">
                <button class="lang-btn-small active" data-lang="en">ğŸ‡ºğŸ‡¸ EN</button>
                <button class="lang-btn-small" data-lang="es">ğŸ‡ªğŸ‡¸ ES</button>
                <button class="lang-btn-small" data-lang="ar">ğŸ‡¸ğŸ‡¦ AR</button>
            </div>

            <!-- Removed old language switcher -->
            <!-- *** FIX: Increased top-padding on mobile (pt-16) to clear language buttons *** -->
            <h1 class="text-4xl md:text-6xl font-bold text-gray-900 pt-16 md:pt-2" data-key="title">DBQ: Madison on Democracy and the Republic</h1>
            <p class="text-2xl md:text-3xl text-gray-700 mt-2" data-key="subtitle">Analyzing Federalist Nos. 10, 39, & 51</p>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-nav flex justify-center border-b border-gray-300 mb-8 font-ui">
            <button class="tab-btn active" data-tab="questions" data-key="tab_questions">Key Questions ğŸ”‘</button>
            <!-- NEW "Class Notes" Tab -->
            <button class="tab-btn" data-tab="notes" data-key="tab_notes">Class Notes ğŸ“</button>
            <button class="tab-btn" data-tab="doc1" data-key="tab_doc1">Fed. 10 ğŸ“„</button>
            <button class="tab-btn" data-tab="doc2" data-key="tab_doc2">Fed. 39 ğŸ“œ</button>
            <button class="tab-btn" data-tab="doc3" data-key="tab_doc3">Fed. 51 ğŸ›ï¸</button>
        </nav>

        <!-- Content Area -->
        <main id="content-area" class="bg-white rounded-lg shadow-xl p-8 md:p-16">
            
            <!-- Key Questions Tab -->
            <section id="questions" class="tab-content active content-text question-section">
                <h2 class="text-3xl md:text-5xl font-bold mb-8 font-ui" data-key="questions_header">Guiding Questions</h2>
                
                <h3 class="text-2xl md:text-4xl font-semibold mb-4 text-gray-700 font-ui" data-key="q_main_essay_header">Main Essay Question:</h3>
                <p class="mb-8 pl-4 border-l-4 border-gray-200" data-key="q_main_essay">According to James Madison, why is a republic superior to a pure democracy, and what mechanisms are necessary to ensure a republic functions properly?</p>

                <h3 class="text-2xl md:text-4xl font-semibold mb-4 text-gray-700 font-ui" data-key="q_doc1_header">Document 1 (Fed. 10):</h3>
                <ul class="list-disc pl-8 mb-8 space-y-2">
                    <li data-key="q_doc1_1">What is the main problem ("mischief") of a pure democracy?</li>
                    <li data-key="q_doc1_2">What are the two big differences between a democracy and a republic?</li>
                </ul>

                <h3 class="text-2xl md:text-4xl font-semibold mb-4 text-gray-700 font-ui" data-key="q_doc2_header">Document 2 (Fed. 39):</h3>
                <ul class="list-disc pl-8 mb-8 space-y-2">
                    <li data-key="q_doc2_1">Where must a republican government get its power from?</li>
                    <li data-key="q_doc2_2">What does Madison say is "ESSENTIAL" for a government to be republican?</li>
                </ul>

                <h3 class="text-2xl md:text-4xl font-semibold mb-4 text-gray-700 font-ui" data-key="q_doc3_header">Document 3 (Fed. 51):</h3>
                <ul class="list-disc pl-8 mb-8 space-y-2">
                    <li data-key="q_doc3_1">What is the "great difficulty" in creating a government "administered by men over men"?</li>
                    <li data-key="q_doc3_2">What is the "primary control" on government?</li>
                    <li data-key="q_doc3_3">What are the "auxiliary precautions" (backup plans) needed for?</li>
                </ul>
            </section>

            <!-- NEW Class Notes Tab -->
            <section id="notes" class="tab-content content-text">
                <h2 class="text-3xl md:text-5xl font-bold mb-8 font-ui" data-key="notes_header">Class Notes</h2>
                <textarea id="notes-textarea" class="font-ui" data-key-placeholder="notes_placeholder" placeholder="Type your class notes here... This text is not saved and will reset if you reload the page."></textarea>
            </section>

            <!-- Document 1: Federalist No. 10 -->
            <section id="doc1" class="tab-content content-text">
                <h2 class="text-3xl md:text-5xl font-bold mb-6 font-ui" data-key="doc1_title">Document 1: James Madison, *Federalist No. 10* (1787)</h2>
                
                <div class="mb-8 font-ui">
                    <button class="main-idea-btn text-2xl font-semibold py-3 px-6 rounded-lg mb-4 inline-flex items-center gap-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a1 1 0 011 1v1.016a.993.993 0 00.993.993h.017a1 1 0 110 2h-.017a.993.993 0 00-.993.993v1.994a.993.993 0 00.993.993h.017a1 1 0 110 2h-.017a.993.993 0 00-.993.993V15a1 1 0 11-2 0v-1.016a.993.993 0 00-.993-.993h-.017a1 1 0 110-2h.017a.993.993 0 00.993-.993V6.016a.993.993 0 00-.993-.993h-.017a1 1 0 110-2h.017A.993.993 0 009 3.016V2a1 1 0 011-1zM3 8a1 1 0 011-1h.017a.993.993 0 00.993-.993V4a1 1 0 112 0v2.016a.993.993 0 00.993.993h.017a1 1 0 110 2h-.017a.993.993 0 00-.993.993V11a1 1 0 11-2 0V8.984a.993.993 0 00-.993-.993H4a1 1 0 01-1-1zM15 8a1 1 0 011-1h.017a.993.993 0 00.993-.993V4a1 1 0 112 0v2.016a.993.993 0 00.993.993h.017a1 1 0 110 2h-.017a.993.993 0 00-.993.993V11a1 1 0 11-2 0V8.984a.993.993 0 00-.993-.993H16a1 1 0 01-1-1z" /></svg>
                        <span data-key="show_main_idea">Show Main Idea</span>
                    </button>
                    <div class="main-idea-content hidden p-6 rounded-lg">
                        <p class="text-2xl font-medium"><strong data-key="main_idea_label">Main Idea:</strong> <span data-key="doc1_main_idea">Pure democracies fail because they can't control majority factions, but a republic (with elected representatives and a larger population) can.</span></p>
                    </div>
                </div>

                <!-- Source text remains in English -->
                <p class="mb-8">"A <span class="simplifier-term" data-term="pure-democracy">pure democracy</span>, by which I mean a society consisting of a small number of citizens, who assemble and administer the government in person, can admit of no cure for the <span class="simplifier-term" data-term="mischiefs-of-faction">mischiefs of</span> <span class="simplifier-term" data-term="faction">faction</span>. A common passion or interest will, in almost every case, be felt by a majority of the whole...and there is nothing to check the inducements to sacrifice the weaker party or an obnoxious individual."</p>
                <p>"A <span class="simplifier-term" data-term="republic">republic</span>, by which I mean a government in which the scheme of <span class="simplifier-term" data-term="representation">representation</span> takes place, opens a different prospect, and promises the cure for which we are seeking. The two great points of difference between a democracy and a republic are: first, the <span class="simplifier-term" data-term="delegation">delegation of the government</span>, in the latter, to a small number of citizens elected by the rest; secondly, the greater number of citizens, and greater sphere of country, over which the latter may be extended."</p>
            </section>

            <!-- Document 2: Federalist No. 39 -->
            <section id="doc2" class="tab-content content-text">
                <h2 class="text-3xl md:text-5xl font-bold mb-6 font-ui" data-key="doc2_title">Document 2: James Madison, *Federalist No. 39* (1788)</h2>
                <div class="mb-8 font-ui">
                    <button class="main-idea-btn text-2xl font-semibold py-3 px-6 rounded-lg mb-4 inline-flex items-center gap-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a1 1 0 011 1v1.016a.993.993 0 00.993.993h.017a1 1 0 110 2h-.017a.993.993 0 00-.993.993v1.994a.993.993 0 00.993.993h.017a1 1 0 110 2h-.017a.993.993 0 00-.993.993V15a1 1 0 11-2 0v-1.016a.993.993 0 00-.993-.993h-.017a1 1 0 110-2h.017a.993.993 0 00.993-.993V6.016a.993.993 0 00-.993-.993h-.017a1 1 0 110-2h.017A.993.993 0 009 3.016V2a1 1 0 011-1zM3 8a1 1 0 011-1h.017a.993.993 0 00.993-.993V4a1 1 0 112 0v2.016a.993.993 0 00.993.993h.017a1 1 0 110 2h-.017a.993.993 0 00-.993.993V11a1 1 0 11-2 0V8.984a.993.993 0 00-.993-.993H4a1 1 0 01-1-1zM15 8a1 1 0 011-1h.017a.993.993 0 00.993-.993V4a1 1 0 112 0v2.016a.993.993 0 00.993.993h.017a1 1 0 110 2h-.017a.993.993 0 00-.993.993V11a1 1 0 11-2 0V8.984a.993.993 0 00-.993-.993H16a1 1 0 01-1-1z" /></svg>
                        <span data-key="show_main_idea">Show Main Idea</span>
                    </button>
                    <div class="main-idea-content hidden p-6 rounded-lg">
                        <p class="text-2xl font-medium"><strong data-key="main_idea_label">Main Idea:</strong> <span data-key="doc2_main_idea">A true republic is a government that gets its power from the *entire* population (not a small or favored group) and is run by officials chosen by the people.</span></p>
                    </div>
                </div>
                <!-- Source text remains in English -->
                <p>"We may define a <span class="simplifier-term" data-term="republic">republic</span> to be...a government which <span class="simplifier-term" data-term="derives-powers">derives all its powers directly or indirectly from the great body of the people</span>, and is administered by persons holding their offices during pleasure, for a limited period, or during good behavior. It is ESSENTIAL to such a government that it be derived from the <span class="simplifier-term" data-term="great-body">great body of the society</span>, not from an inconsiderable proportion, or a <span class="simplifier-term" data-term="favored-class">favored class</span> of it... It is SUFFICIENT for such a government that the persons administering it be appointed, either directly or indirectly, by the people."</p>
            </section>

            <!-- Document 3: Federalist No. 51 -->
            <section id="doc3" class="tab-content content-text">
                <h2 class="text-3xl md:text-5xl font-bold mb-6 font-ui" data-key="doc3_title">Document 3: James Madison, *Federalist No. 51* (1788)</h2>
                <div class="mb-8 font-ui">
                    <button class="main-idea-btn text-2xl font-semibold py-3 px-6 rounded-lg mb-4 inline-flex items-center gap-3">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a1 1 0 011 1v1.016a.993.993 0 00.993.993h.017a1 1 0 110 2h-.017a.993.993 0 00-.993.993v1.994a.993.993 0 00.993.993h.017a1 1 0 110 2h-.017a.993.993 0 00-.993.993V15a1 1 0 11-2 0v-1.016a.993.993 0 00-.993-.993h-.017a1 1 0 110-2h.017a.993.993 0 00.993-.993V6.016a.993.993 0 00-.993-.993h-.017a1 1 0 110-2h.017A.993.993 0 009 3.016V2a1 1 0 011-1zM3 8a1 1 0 011-1h.017a.993.993 0 00.993-.993V4a1 1 0 112 0v2.016a.993.993 0 00.993.993h.017a1 1 0 110 2h-.017a.993.993 0 00-.993.993V11a1 1 0 11-2 0V8.984a.993.993 0 00-.993-.993H4a1 1 0 01-1-1zM15 8a1 1 0 011-1h.017a.993.993 0 00.993-.993V4a1 1 0 112 0v2.016a.993.993 0 00.993.993h.017a1 1 0 110 2h-.017a.993.993 0 00-.993.993V11a1 1 0 11-2 0V8.984a.993.993 0 00-.993-.993H16a1 1 0 01-1-1z" /></svg>
                        <span data-key="show_main_idea">Show Main Idea</span>
                    </button>
                    <div class="main-idea-content hidden p-6 rounded-lg">
                        <p class="text-2xl font-medium"><strong data-key="main_idea_label">Main Idea:</strong> <span data-key="doc3_main_idea">Since people aren't angels, government must be controlled. Voting is the main control, but "auxiliary precautions" (like checks and balances) are also necessary to make ambition fight ambition.</span></p>
                    </div>
                </div>
                <!-- Source text remains in English -->
                <p class="mb-8">"If men were angels, no government would be necessary. If angels were to govern men, neither external nor <span class="simplifier-term" data-term="internal-controls">internal controls</span> on government would be necessary. In framing a government which is to be administered by men over men, the great difficulty lies in this: you must first enable the government to control the governed; and in the next place oblige it to control itself."</p>
                <p class="mb-8">"A <span class="simplifier-term" data-term="dependence-on-people">dependence on the people</span> is, no doubt, the primary control on the government; but experience has taught mankind the necessity of <span class="simplifier-term" data-term="auxiliary-precautions">auxiliary precautions</span>... <span class="simplifier-term" data-term="ambition">Ambition must be made to counteract ambition</span>. The interest of the. man must be connected with the constitutional rights of the place."</p>
            </section>
        </main>

        <!-- Accessibility Footer (Collapsible) -->
        <footer class="mt-12 font-ui">
            <button id="tools-toggle-btn" class="w-full p-6 bg-white rounded-lg shadow-md text-3xl font-semibold text-center text-gray-800 hover:bg-gray-50 transition-colors" data-key="tools_header">
                Accessibility Tools ğŸ› ï¸
            </button>
            <div id="tools-panel" class="hidden p-8 bg-white border-t border-gray-200 mt-2 rounded-b-lg">
                <div class="flex flex-wrap justify-center gap-4 md:gap-6">
                    <!-- Font Size -->
                    <div class="flex items-center gap-3">
                        <span class="text-2xl font-medium text-gray-700" data-key="font_size">Font Size ğŸ”¡:</span>
                        <button id="font-decrease" class="control-btn w-16 h-16" aria-label="Decrease font size">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z" clip-rule="evenodd" /></svg>
                        </button>
                        <button id="font-increase" class="control-btn w-16 h-16" aria-label="Increase font size">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                        </button>
                    </div>
                    
                    <!-- Text to Speech -->
                    <div class="flex items-center gap-3">
                        <button id="speak-btn" class="control-btn py-4 px-6 text-2xl inline-flex items-center gap-3" aria-label="Read text aloud">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            <span data-key="speak">Speak ğŸ—£ï¸</span>
                        </button>
                        <button id="stop-btn" class="control-btn py-4 px-6 text-2xl inline-flex items-center gap-3" aria-label="Stop reading">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd" /></svg>
                            <span data-key="stop">Stop â¹ï¸</span>
                        </button>
                    </div>

                    <!-- High Contrast -->
                    <div class="flex items-center gap-3">
                        <button id="contrast-toggle" class="control-btn py-4 px-6 text-2xl inline-flex items-center gap-3" aria-label="Toggle high contrast mode">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM10 3.5a6.5 6.5 0 110 13V3.5z" /></svg>
                            <span data-key="contrast">Contrast ğŸŒ—</span>
                        </button>
                    </div>

                    <!-- Focus Mode -->
                    <div class="flex items-center gap-3">
                        <button id="reading-ruler-toggle" class="control-btn py-4 px-6 text-2xl inline-flex items-center gap-3" aria-label="Toggle reading focus mode">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z" /><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.022 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" /></svg>
                            <span data-key="focus">Focus ğŸ‘ï¸</span>
                        </button>
                    </div>

                    <!-- NEW Highlighter Toggle -->
                    <div class="flex items-center gap-3">
                        <button id="highlighter-toggle" class="control-btn py-4 px-6 text-2xl inline-flex items-center gap-3" aria-label="Toggle highlighter mode">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
                            <span data-key="highlighter">Highlighter  highlighter</span>
                        </button>
                    </div>

                </div>
            </div>
        </footer>

    </div>

    <!-- Simplifier Modal - Restyled -->
    <div id="simplifier-modal" class="modal font-ui">
        <div class="modal-container bg-white shadow-2xl">
            <!-- Modal Header -->
            <div class="modal-header bg-blue-700 text-white">
                <h3 id="modal-term" class="text-5xl font-bold">Term</h3>
                <button id="modal-close" class="modal-close text-6xl font-light text-white">&times;</button>
            </div>
            <!-- Modal Body -->
            <div class="modal-body bg-white">
                <p id="modal-definition" class="text-4xl text-gray-700"></p>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.tab-btn');
            const contents = document.querySelectorAll('.tab-content');
            const contentArea = document.getElementById('content-area');
            const appContainer = document.getElementById('app-container');
            let activeTab = 'questions'; // Default tab
            let currentLang = 'en'; // Default language

            // --- Translation Data ---
            const translations = {
                en: {
                    title: "DBQ: Madison on Democracy and the Republic",
                    subtitle: "Analyzing Federalist Nos. 10, 39, & 51",
                    tab_questions: "Key Questions ğŸ”‘",
                    tab_notes: "Class Notes ğŸ“", // NEW
                    tab_doc1: "Fed. 10 ğŸ“„",
                    tab_doc2: "Fed. 39 ğŸ“œ",
                    tab_doc3: "Fed. 51 ğŸ›ï¸",
                    questions_header: "Guiding Questions",
                    notes_header: "Class Notes", // NEW
                    notes_placeholder: "Type your class notes here... This text is not saved and will reset if you reload the page.", // NEW
                    q_main_essay_header: "Main Essay Question:",
                    q_main_essay: "According to James Madison, why is a republic superior to a pure democracy, and what mechanisms are necessary to ensure a republic functions properly?",
                    q_doc1_header: "Document 1 (Fed. 10):",
                    q_doc1_1: "What is the main problem ('mischief') of a pure democracy?",
                    q_doc1_2: "What are the two big differences between a democracy and a republic?",
                    q_doc2_header: "Document 2 (Fed. 39):",
                    q_doc2_1: "Where must a republican government get its power from?",
                    q_doc2_2: "What does Madison say is 'ESSENTIAL' for a government to be republican?",
                    q_doc3_header: "Document 3 (Fed. 51):",
                    q_doc3_1: "What is the 'great difficulty' in creating a government 'administered by men over men'?",
                    q_doc3_2: "What is the 'primary control' on government?",
                    q_doc3_3: "What are the 'auxiliary precautions' (backup plans) needed for?",
                    doc1_title: "Document 1: James Madison, *Federalist No. 10* (1787)",
                    doc2_title: "Document 2: James Madison, *Federalist No. 39* (1788)",
                    doc3_title: "Document 3: James Madison, *Federalist No. 51* (1788)",
                    show_main_idea: "Show Main Idea",
                    hide_main_idea: "Hide Main Idea",
                    main_idea_label: "Main Idea:",
                    doc1_main_idea: "Pure democracies fail because they can't control majority factions, but a republic (with elected representatives and a larger population) can.",
                    doc2_main_idea: "A true republic is a government that gets its power from the *entire* population (not a small or favored group) and is run by officials chosen by the people.",
                    doc3_main_idea: "Since people aren't angels, government must be controlled. Voting is the main control, but 'auxiliary precautions' (like checks and balances) are also necessary to make ambition fight ambition.",
                    tools_header: "Accessibility Tools ğŸ› ï¸",
                    font_size: "Font Size ğŸ”¡:",
                    speak: "Speak ğŸ—£ï¸",
                    stop: "Stop â¹ï¸",
                    contrast: "Contrast ğŸŒ—",
                    focus: "Focus ğŸ‘ï¸",
                    highlighter: "Highlighter  highlighter" // NEW
                },
                es: {
                    title: "DBQ: Madison sobre la democracia y la repÃºblica",
                    subtitle: "AnÃ¡lisis de El Federalista Nos. 10, 39 y 51",
                    tab_questions: "Preguntas clave ğŸ”‘",
                    tab_notes: "Notas de clase ğŸ“", // NEW
                    tab_doc1: "Fed. 10 ğŸ“„",
                    tab_doc2: "Fed. 39 ğŸ“œ",
                    tab_doc3: "Fed. 51 ğŸ›ï¸",
                    questions_header: "Preguntas orientadoras",
                    notes_header: "Notas de clase", // NEW
                    notes_placeholder: "Escriba las notas de su clase aquÃ­... Este texto no se guarda y se restablecerÃ¡ si recarga la pÃ¡gina.", // NEW
                    q_main_essay_header: "Pregunta principal del ensayo:",
                    q_main_essay: "SegÃºn James Madison, Â¿por quÃ© una repÃºblica es superior a una democracia pura y quÃ© mecanismos son necesarios para asegurar que una repÃºblica funcione correctamente?",
                    q_doc1_header: "Documento 1 (Fed. 10):",
                    q_doc1_1: "Â¿CuÃ¡l es el principal problema ('maldad') de una democracia pura?",
                    q_doc1_2: "Â¿CuÃ¡les son las dos grandes diferencias entre una democracia y una repÃºblica?",
                    q_doc2_header: "Documento 2 (Fed. 39):",
                    q_doc2_1: "Â¿De dÃ³nde debe obtener su poder un gobierno republicano?",
                    q_doc2_2: "Â¿QuÃ© dice Madison que es 'ESENCIAL' para que un gobierno sea republicano?",
                    q_doc3_header: "Documento 3 (Fed. 51):",
                    q_doc3_1: "Â¿CuÃ¡l es la 'gran dificultad' al crear un gobierno 'administrado por hombres sobre hombres'?",
                    q_doc3_2: "Â¿CuÃ¡l es el 'control primario' sobre el gobierno?",
                    q_doc3_3: "Â¿Para quÃ© se necesitan las 'precauciones auxiliares' (planes de respaldo)?",
                    doc1_title: "Documento 1: James Madison, *El Federalista No. 10* (1787)",
                    doc2_title: "Documento 2: James Madison, *El Federalista No. 39* (1788)",
                    doc3_title: "Documento 3: James Madison, *El Federalista No. 51* (1788)",
                    show_main_idea: "Mostrar idea principal",
                    hide_main_idea: "Ocultar idea principal",
                    main_idea_label: "Idea principal:",
                    doc1_main_idea: "Las democracias puras fracasan porque no pueden controlar las facciones mayoritarias, pero una repÃºblica (con representantes elegidos y una poblaciÃ³n mÃ¡s grande) sÃ­ puede.",
                    doc2_main_idea: "Una verdadera repÃºblica es un gobierno que obtiene su poder de *toda* la poblaciÃ³n (no de un grupo pequeÃ±o o favorecido) y es dirigida por funcionarios elegidos por el pueblo.",
                    doc3_main_idea: "Dado que las personas no son Ã¡ngeles, el gobierno debe ser controlado. Votar es el control principal, pero tambiÃ©n se necesitan 'precauciones auxiliares' (como frenos y contrapesos) para hacer que la ambiciÃ³n contrarreste a la ambiciÃ³n.",
                    tools_header: "Herramientas de accesibilidad ğŸ› ï¸",
                    font_size: "TamaÃ±o de fuente ğŸ”¡:",
                    speak: "Hablar ğŸ—£ï¸",
                    stop: "Parar â¹ï¸",
                    contrast: "Contraste ğŸŒ—",
                    focus: "Enfoque ğŸ‘ï¸",
                    highlighter: "Resaltador highlighter" // NEW
                },
                ar: {
                    title: "DBQ: Ù…Ø§Ø¯ÙŠØ³ÙˆÙ† Ø­ÙˆÙ„ Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© ÙˆØ§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ©",
                    subtitle: "ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ Ø±Ù‚Ù… 10 Ùˆ 39 Ùˆ 51",
                    tab_questions: "Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ğŸ”‘",
                    tab_notes: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØµÙ ğŸ“", // NEW
                    tab_doc1: "Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 10 ğŸ“„",
                    tab_doc2: "Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 39 ğŸ“œ",
                    tab_doc3: "Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 51 ğŸ›ï¸",
                    questions_header: "Ø£Ø³Ø¦Ù„Ø© Ø¥rshadie",
                    notes_header: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØµÙ", // NEW
                    notes_placeholder: "Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØµÙÙƒ Ù‡Ù†Ø§... Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ ØºÙŠØ± Ù…Ø­ÙÙˆØ¸ ÙˆØ³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†Ù‡ Ø¥Ø°Ø§ Ù‚Ù…Øª Ø¨Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.", // NEW
                    q_main_essay_header: "Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ:",
                    q_main_essay: "ÙˆÙÙ‚Ù‹Ø§ Ù„Ø¬ÙŠÙ…Ø³ Ù…Ø§Ø¯ÙŠØ³ÙˆÙ†ØŒ Ù„Ù…Ø§Ø°Ø§ ØªØªÙÙˆÙ‚ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ø¨Ø­ØªØ©ØŒ ÙˆÙ…Ø§ Ù‡ÙŠ Ø§Ù„Ø¢Ù„ÙŠØ§Øª Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ØŸ",
                    q_doc1_header: "Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© 1 (Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 10):",
                    q_doc1_1: "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ('Ø§Ù„Ø£Ø°Ù‰') Ù„Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ø¨Ø­ØªØ©ØŸ",
                    q_doc1_2: "Ù…Ø§ Ù‡Ù…Ø§ Ø§Ù„ÙØ±ÙˆÙ‚Ø§Ù† Ø§Ù„ÙƒØ¨ÙŠØ±Ø§Ù† Ø¨ÙŠÙ† Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© ÙˆØ§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ©ØŸ",
                    q_doc2_header: "Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© 2 (Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 39):",
                    q_doc2_1: "Ù…Ù† Ø£ÙŠÙ† ÙŠØ¬Ø¨ Ø£Ù† ØªØ³ØªÙ…Ø¯ Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø³Ù„Ø·ØªÙ‡Ø§ØŸ",
                    q_doc2_2: "Ù…Ø§ Ø§Ù„Ø°ÙŠ ÙŠÙ‚ÙˆÙ„ Ù…Ø§Ø¯ÙŠØ³ÙˆÙ† Ø¥Ù†Ù‡ 'Ø£Ø³Ø§Ø³ÙŠ' Ù„ÙƒÙŠ ØªÙƒÙˆÙ† Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ø¬Ù…Ù‡ÙˆØ±ÙŠØ©ØŸ",
                    q_doc3_header: "Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© 3 (Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ 51):",
                    q_doc3_1: "Ù…Ø§ Ù‡ÙŠ 'Ø§Ù„ØµØ¹ÙˆØ¨Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰' ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø­ÙƒÙˆÙ…Ø© 'ÙŠØ¯ÙŠØ±Ù‡Ø§ Ø±Ø¬Ø§Ù„ Ø¹Ù„Ù‰ Ø±Ø¬Ø§Ù„'ØŸ",
                    q_doc3_2: "Ù…Ø§ Ù‡ÙŠ 'Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©' Ø¹Ù„Ù‰ Ø§Ù„Ø­ÙƒÙˆÙ…Ø©ØŸ",
                    q_doc3_3: "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø­Ø§Ø¬Ø© Ø¥Ù„Ù‰ 'Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©' (Ø®Ø·Ø· Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©)ØŸ",
                    doc1_title: "Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© 1: Ø¬ÙŠÙ…Ø³ Ù…Ø§Ø¯ÙŠØ³ONØŒ *Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ Ø±Ù‚Ù… 10* (1787)",
                    doc2_title: "Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© 2: Ø¬ÙŠÙ…Ø³ Ù…Ø§Ø¯ÙŠØ³ÙˆÙ†ØŒ *Ø§Ù„ÙÙŠØ¯Ø±Ø§Ù„ÙŠ Ø±Ù‚Ù… 39* (1788)",
                    doc3_title: "Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© 3: Ø¬ÙŠÙ…Ø³ Ù…Ø§Ø¯ÙŠØ³ÙˆÙ†ØŒ *Ø§Ù„ÙÙŠØ¯rØ§Ù„ÙŠ Ø±Ù‚Ù… 51* (1788)",
                    show_main_idea: "Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
                    hide_main_idea: "Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
                    main_idea_label: "Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:",
                    doc1_main_idea: "ØªÙØ´Ù„ Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ§Øª Ø§Ù„Ø¨Ø­ØªØ© Ù„Ø£Ù†Ù‡Ø§ Ù„Ø§ ØªØ³ØªØ·ÙŠØ¹ Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø¹Ù„Ù‰ ÙØµØ§Ø¦Ù„ Ø§Ù„Ø£ØºÙ„Ø¨ÙŠØ©ØŒ Ù„ÙƒÙ† Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© (Ù…Ø¹ Ù…Ù…Ø«Ù„ÙŠÙ† Ù…Ù†ØªØ®Ø¨ÙŠÙ† ÙˆØ¹Ø¯Ø¯ Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ø³ÙƒØ§Ù†) ØªØ³ØªØ·ÙŠØ¹ Ø°Ù„Ùƒ.",
                    doc2_main_idea: "Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù‡ÙŠ Ø­ÙƒÙˆÙ…Ø© ØªØ³ØªÙ…Ø¯ Ø³Ù„Ø·ØªÙ‡Ø§ Ù…Ù† *Ø¬Ù…ÙŠØ¹* Ø£ÙØ±Ø§Ø¯ Ø§Ù„Ø´Ø¹Ø¨ (ÙˆÙ„ÙŠØ³ Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹Ø© ØµØºÙŠØ±Ø© Ø£Ùˆ Ù…ÙØ¶Ù„Ø©) ÙˆÙŠØ¯ÙŠØ±Ù‡Ø§ Ù…Ø³Ø¤ÙˆÙ„ÙˆÙ† ÙŠØ®ØªØ§Ø±Ù‡Ù… Ø§Ù„Ø´Ø¹Ø¨.",
                    doc3_main_idea: "Ø¨Ù…Ø§ Ø£Ù† Ø§Ù„Ù†Ø§Ø³ Ù„ÙŠØ³ÙˆØ§ Ù…Ù„Ø§Ø¦ÙƒØ©ØŒ ÙŠØ¬Ø¨ Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø­ÙƒÙˆÙ…Ø©. Ø§Ù„ØªØµÙˆÙŠØª Ù‡Ùˆ Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©ØŒ ÙˆÙ„ÙƒÙ† 'Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©' (Ù…Ø«Ù„ Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· ÙˆØ§Ù„ØªÙˆØ§Ø²Ù†Ø§Øª) Ø¶Ø±ÙˆØ±ÙŠØ© Ø£ÙŠØ¶Ù‹Ø§ Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø·Ù…ÙˆØ­ ÙŠÙˆØ§Ø¬Ù‡ Ø§Ù„Ø·Ù…ÙˆØ­.",
                    tools_header: "Ø£Ø¯ÙˆØ§Øª Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ ğŸ› ï¸",
                    font_size: "Ø­Ø¬Ù… Ø§Ù„Ø®Ø· ğŸ”¡:",
                    speak: "ØªØ­Ø¯Ø« ğŸ—£ï¸",
                    stop: "ØªÙˆÙ‚Ù â¹ï¸",
                    contrast: "ØªØ¨Ø§ÙŠÙ† ğŸŒ—",
                    focus: "ØªØ±ÙƒÙŠØ² ğŸ‘ï¸",
                    highlighter: "Ø£Ø¯Ø§Ø© Ø§Ù„ØªÙ…ÙŠÙŠØ² highlighter" // NEW
                }
            };

            // --- Simplifier Modal ---
            // *** UPDATED with 5 new terms ***
            const simplifierTerms = {
                'pure-democracy': {
                    term_en: 'Pure Democracy / Direct Democracy',
                    definition_en: "A system (also known as 'direct democracy') where all citizens gather in one place to vote on every single law themselves. Madison says this only works for a very small town and is dangerous because a majority can easily team up against a minority.",
                    term_es: 'Democracia Pura / Democracia Directa',
                    definition_es: "Un sistema (tambiÃ©n conocido como 'democracia directa') donde todos los ciudadanos se reÃºnen en un solo lugar para votar sobre cada ley ellos mismos. Madison dice que esto solo funciona en un pueblo muy pequeÃ±o y es peligroso porque una mayorÃ­a puede fÃ¡cilmente unirse contra una minorÃ­a.",
                    term_ar: 'Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ø¨Ø­ØªØ© / Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©',
                    definition_ar: "Ù†Ø¸Ø§Ù… (ÙŠÙØ¹Ø±Ù Ø£ÙŠØ¶Ù‹Ø§ Ø¨Ø§Ø³Ù… 'Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©') Ø­ÙŠØ« ÙŠØ¬ØªÙ…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ† ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯ Ù„Ù„ØªØµÙˆÙŠØª Ø¹Ù„Ù‰ ÙƒÙ„ Ù‚Ø§Ù†ÙˆÙ† Ø¨Ø£Ù†ÙØ³Ù‡Ù…. ÙŠÙ‚ÙˆÙ„ Ù…Ø§Ø¯ÙŠØ³ÙˆÙ† Ø¥Ù† Ù‡Ø°Ø§ Ù„Ø§ ÙŠÙ†Ø¬Ø­ Ø¥Ù„Ø§ ÙÙŠ Ø¨Ù„Ø¯Ø© ØµØºÙŠØ±Ø© Ø¬Ø¯Ù‹Ø§ ÙˆÙ‡Ùˆ Ø®Ø·ÙŠØ± Ù„Ø£Ù† Ø§Ù„Ø£ØºÙ„Ø¨ÙŠØ© ÙŠÙ…ÙƒÙ†Ù‡Ø§ Ø¨Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ØªÙƒØªÙ„ Ø¶Ø¯ Ø§Ù„Ø£Ù‚Ù„ÙŠØ©."
                },
                'mischiefs-of-faction': {
                    term_en: 'Mischiefs of Faction',
                    definition_en: "The problems, damage, and injustice caused by groups of citizens (either a majority or minority) who are united by a common interest that might hurt the rights of other people or the good of the whole country.",
                    term_es: 'Maldades de la facciÃ³n',
                    definition_es: "Los problemas, daÃ±os e injusticias causados por grupos de ciudadanos (ya sea una mayorÃ­a o una minorÃ­a) que estÃ¡n unidos por un interÃ©s comÃºn que podrÃ­a perjudicar los derechos de otras personas o el bien de todo el paÃ­s.",
                    term_ar: 'Ù…Ø³Ø§ÙˆØ¦ Ø§Ù„ÙØµØ§Ø¦Ù„',
                    definition_ar: "Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ ÙˆØ§Ù„Ø£Ø¶Ø±Ø§Ø± ÙˆØ§Ù„Ø¸Ù„Ù… Ø§Ù„Ø°ÙŠ ØªØ³Ø¨Ø¨Ù‡ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ† (Ø³ÙˆØ§Ø¡ ÙƒØ§Ù†Øª Ø£ØºÙ„Ø¨ÙŠØ© Ø£Ùˆ Ø£Ù‚Ù„ÙŠØ©) Ù…ØªØ­Ø¯ÙˆÙ† Ø¨Ù…ØµÙ„Ø­Ø© Ù…Ø´ØªØ±ÙƒØ© Ù‚Ø¯ ØªØ¶Ø± Ø¨Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ø£Ùˆ Ø¨ØµØ§Ù„Ø­ Ø§Ù„Ø¨Ù„Ø¯ Ø¨Ø£ÙƒÙ…Ù„Ù‡."
                },
                'faction': { // NEW
                    term_en: 'Faction',
                    definition_en: "A group of citizens (either a majority or minority) united by a common interest or passion that is against the rights of other citizens or the overall good of the community.",
                    term_es: 'FacciÃ³n',
                    definition_es: "Un grupo de ciudadanos (ya sea una mayorÃ­a o una minorÃ­a) unidos por un interÃ©s o pasiÃ³n comÃºn que va en contra de los derechos de otros ciudadanos o del bien general de la comunidad.",
                    term_ar: 'ÙØµÙŠÙ„',
                    definition_ar: "Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ† (Ø³ÙˆØ§Ø¡ ÙƒØ§Ù†Øª Ø£ØºÙ„Ø¨ÙŠØ© Ø£Ùˆ Ø£Ù‚Ù„ÙŠØ©) Ù…ØªØ­Ø¯ÙˆÙ† Ø¨Ù…ØµÙ„Ø­Ø© Ø£Ùˆ Ù‡ÙˆÙ‰ Ù…Ø´ØªØ±Ùƒ ÙŠØªØ¹Ø§Ø±Ø¶ Ù…Ø¹ Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ø£Ùˆ Ø§Ù„Ù…ØµÙ„Ø­Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ù…Ø¬ØªÙ…Ø¹."
                },
                'republic': {
                    term_en: 'Republic',
                    definition_en: "A system where citizens elect a smaller number of people (representatives) to make laws and run the government for them. Madison argues this is better because it can handle a larger country and filter out bad ideas.",
                    term_es: 'RepÃºblica',
                    definition_es: "Un sistema donde los citizens eligen a un nÃºmero menor de personas (representantes) para que hagan las leyes y dirijan el gobierno por ellos. Madison argumenta que esto es mejor porque puede manejar un paÃ­s mÃ¡s grande y filtrar las malas ideas.",
                    term_ar: 'Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ©',
                    definition_ar: "Ù†Ø¸Ø§Ù… ÙŠÙ†ØªØ®Ø¨ ÙÙŠÙ‡ Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙˆÙ† Ø¹Ø¯Ø¯Ù‹Ø§ Ø£ØµØºØ± Ù…Ù† Ø§Ù„Ø£Ø´Ø®Ø§Øµ (Ù…Ù…Ø«Ù„ÙŠÙ†) Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ù†ÙŠØ§Ø¨Ø© Ø¹Ù†Ù‡Ù…. ÙŠØ¬Ø§Ø¯Ù„ Ù…Ø§Ø¯ÙŠØ³ON Ø¨Ø£Ù† Ù‡Ø°Ø§ Ø£ÙØ¶Ù„ Ù„Ø£Ù†Ù‡ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¨Ù„Ø¯ Ø£ÙƒØ¨Ø± ÙˆØªØµÙÙŠØ© Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø³ÙŠØ¦Ø©."
                },
                'representation': { // NEW
                    term_en: 'Representation',
                    definition_en: "The system where citizens elect a smaller number of people to make laws and run the government on their behalf. This is the core difference between a republic and a pure democracy.",
                    term_es: 'RepresentaciÃ³n',
                    definition_es: "El sistema donde los ciudadanos eligen a un nÃºmero menor de personas para que hagan las leyes y dirijan el gobierno en su nombre. Esta es la diferencia principal entre una repÃºblica y una democracia pura.",
                    term_ar: 'Ø§Ù„ØªÙ…Ø«ÙŠÙ„',
                    definition_ar: "Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙŠ ÙŠÙ†ØªØ®Ø¨ ÙÙŠÙ‡ Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙˆÙ† Ø¹Ø¯Ø¯Ù‹Ø§ Ø£ØµØºØ± Ù…Ù† Ø§Ù„Ø£Ø´Ø®Ø§Øµ Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ù†ÙŠØ§Ø¨Ø© Ø¹Ù†Ù‡Ù…. Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© ÙˆØ§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ø¨Ø­ØªØ©."
                },
                'delegation': {
                    term_en: 'Delegation of the Government',
                    definition_en: "The act of giving the power to govern to the representatives you elected. You are 'delegating' your power to them to act on your behalf.",
                    term_es: 'DelegaciÃ³n del Gobierno',
                    definition_es: "El acto de ceder el poder de gobernar a los representantes que elegiste. EstÃ¡s 'delegando' tu poder en ellos para que actÃºen en tu nombre.",
                    term_ar: 'ØªÙÙˆÙŠØ¶ Ø§Ù„Ø­ÙƒÙˆÙ…Ø©',
                    definition_ar: "ÙØ¹Ù„ Ù…Ù†Ø­ Ø³Ù„Ø·Ø© Ø§Ù„Ø­ÙƒÙ… Ù„Ù„Ù…Ù…Ø«Ù„ÙŠÙ† Ø§Ù„Ø°ÙŠÙ† Ø§Ù†ØªØ®Ø¨ØªÙ‡Ù…. Ø£Ù†Øª 'ØªÙÙˆØ¶' Ø³Ù„Ø·ØªÙƒ Ù„Ù‡Ù… Ù„Ù„ØªØµØ±Ù Ù†ÙŠØ§Ø¨Ø© Ø¹Ù†Ùƒ."
                },
                'derives-powers': {
                    term_en: 'Derives all its powers... from the people',
                    definition_en: "This means the government gets all of its authority and power from the citizens. It's not a monarchy or aristocracy; the people are the ultimate source of power.",
                    term_es: 'Deriva todos sus poderes... del pueblo',
                    definition_es: "Esto significa que el gobierno obtiene toda su autoridad y poder de los citizens. No es una monarquÃ­a o aristocracia; el pueblo es la fuente Ãºltima de poder.",
                    term_ar: 'ØªØ³ØªÙ…Ø¯ Ø¬Ù…ÙŠØ¹ Ø³Ù„Ø·Ø§ØªÙ‡Ø§... Ù…Ù† Ø§Ù„Ø´Ø¹Ø¨',
                    definition_ar: "Ù‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† Ø§Ù„Ø­ÙƒÙˆÙ…Ø© ØªØ­ØµÙ„ Ø¹Ù„Ù‰ ÙƒÙ„ Ø³Ù„Ø·ØªÙ‡Ø§ ÙˆÙ‚ÙˆØªÙ‡Ø§ Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ†. Ø¥Ù†Ù‡Ø§ Ù„ÙŠØ³Øª Ù…Ù„ÙƒÙŠØ© Ø£Ùˆ Ø£Ø±Ø³ØªÙ‚Ø±Ø§Ø·ÙŠØ©Ø› Ø§Ù„Ø´Ø¹Ø¨ Ù‡Ùˆ Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ø³Ù„Ø·Ø©."
                },
                'great-body': {
                    term_en: 'Great body of the society',
                    definition_en: "All the citizens, not just a small or wealthy group. A republic must represent everyone, not just a 'favored class'.",
                    term_es: 'Gran cuerpo de la sociedad',
                    definition_es: "Todos los citizens, no solo un grupo pequeÃ±o o rico. Una repÃºblica debe representar a todos, no solo a una 'clase favorecida'.",
                    term_ar: 'Ø§Ù„Ø¬Ø³Ù… Ø§Ù„Ø¹Ø¸ÙŠÙ… Ù„Ù„Ù…Ø¬ØªÙ…Ø¹',
                    definition_ar: "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ†, ÙˆÙ„ÙŠØ³ ÙÙ‚Ø· Ù…Ø¬Ù…ÙˆØ¹Ø© ØµØºÙŠØ±Ø© Ø£Ùˆ Ø«Ø±ÙŠØ©. ÙŠØ¬Ø¨ Ø£Ù† ØªÙ…Ø«Ù„ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø¬Ù…ÙŠØ¹, ÙˆÙ„ÙŠØ³ ÙÙ‚Ø· 'Ø·Ø¨Ù‚Ø© Ù…ÙØ¶Ù„Ø©'."
                },
                'favored-class': { // NEW
                    term_en: 'Favored class',
                    definition_en: "A small, privileged group of people (like the wealthy or nobility) who have special status. Madison says a true republic must represent everyone, not just a 'favored class'.",
                    term_es: 'Clase favorecida',
                    definition_es: "Un grupo pequeÃ±o y privilegiado de personas (como los ricos o la nobleza) que tienen un estatus especial. Madison dice que una verdadera repÃºblica debe representar a todos, no solo a una 'clase favorecida'.",
                    term_ar: 'Ø§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©',
                    definition_ar: "Ù…Ø¬Ù…ÙˆØ¹Ø© ØµØºÙŠØ±Ø© ÙˆÙ…ØªÙ…ÙŠØ²Ø© Ù…Ù† Ø§Ù„Ù†Ø§Ø³ (Ù…Ø«Ù„ Ø§Ù„Ø£Ø«Ø±ÙŠØ§Ø¡ Ø£Ùˆ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡) ØªØªÙ…ØªØ¹ Ø¨ÙˆØ¶Ø¹ Ø®Ø§Øµ. ÙŠÙ‚ÙˆÙ„ Ù…Ø§Ø¯ÙŠØ³ÙˆÙ† Ø¥Ù† Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ØªÙ…Ø«Ù„ Ø§Ù„Ø¬Ù…ÙŠØ¹ØŒ ÙˆÙ„ÙŠØ³ ÙÙ‚Ø· 'Ø·Ø¨Ù‚Ø© Ù…ÙØ¶Ù„Ø©'."
                },
                'internal-controls': { // NEW
                    term_en: 'Internal controls',
                    definition_en: "The 'backup plan' to control government from within, in case voting isn't enough. This refers to the system of checks and balances, where the branches of government control each other.",
                    term_es: 'Controles internos',
                    definition_es: "El 'plan de respaldo' para controlar al gobierno desde adentro, en caso de que la votaciÃ³n no sea suficiente. Esto se refiere al sistema de frenos y contrapesos, donde las ramas del gobierno se controlan mutuamente.",
                    term_ar: 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©',
                    definition_ar: "'Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©' Ù„Ù„Ø³ÙŠØ·Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ù…Ù† Ø§Ù„Ø¯Ø§Ø®Ù„ØŒ ÙÙŠ Ø­Ø§Ù„ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„ØªØµÙˆÙŠØª ÙƒØ§ÙÙŠØ§Ù‹. ÙŠØ´ÙŠØ± Ù‡Ø°Ø§ Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· ÙˆØ§Ù„ØªÙˆØ§Ø²Ù†Ø§ØªØŒ Ø­ÙŠØ« ØªØ±Ø§Ù‚Ø¨ ÙØ±ÙˆØ¹ Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ø¨Ø¹Ø¶Ù‡Ø§ Ø§Ù„Ø¨Ø¹Ø¶."
                },
                'dependence-on-people': { // NEW
                    term_en: 'Dependence on the people',
                    definition_en: "The government's reliance on the voters to stay in power. Madison calls this the 'primary control' on government, and it is achieved through regular and free elections.",
                    term_es: 'Dependencia del pueblo',
                    definition_es: "La confianza del gobierno en los votantes para mantenerse en el poder. Madison llama a esto el 'control primario' sobre el gobierno, y se logra a travÃ©s de elecciones regulares y libres.",
                    term_ar: 'Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¹Ø¨',
                    definition_ar: "Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø§Ø®Ø¨ÙŠÙ† Ù„Ù„Ø¨Ù‚Ø§Ø¡ ÙÙŠ Ø§Ù„Ø³Ù„Ø·Ø©. ÙŠØ·Ù„Ù‚ Ù…Ø§Ø¯ÙŠØ³ÙˆÙ† Ø¹Ù„Ù‰ Ù‡Ø°Ø§ 'Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©' Ø¹Ù„Ù‰ Ø§Ù„Ø­ÙƒÙˆÙ…Ø©ØŒ ÙˆÙŠØªÙ… ØªØ­Ù‚ÙŠÙ‚Ù‡ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù†ØªØ®Ø§Ø¨Ø§Øª Ù…Ù†ØªØ¸Ù…Ø© ÙˆØ­Ø±Ø©."
                },
                'auxiliary-precautions': {
                    term_en: 'Auxiliary Precautions',
                    definition_en: "Extra safeguards or 'backup plans' to prevent the government from abusing its power. The main 'precaution' is voting (dependence on the people), but these are extra ones like separation of powers and checks and balances.",
                    term_es: 'Precauciones auxiliares',
                    definition_es: "Salvaguardias adicionales o 'planes de respaldo' para evitar que el gobierno abuse de su poder. La 'precauciÃ³n' principal es la votaciÃ³n (dependencia del pueblo), pero estas son adicionales como la separaciÃ³n de poderes y los frenos y contrapesos.",
                    term_ar: 'Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©',
                    definition_ar: "Ø¶Ù…Ø§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø£Ùˆ 'Ø®Ø·Ø· Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©' Ù„Ù…Ù†Ø¹ Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ù…Ù† Ø¥Ø³Ø§Ø¡Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø³Ù„Ø·ØªÙ‡Ø§. 'Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·' Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù‡Ùˆ Ø§Ù„ØªØµÙˆÙŠØª (Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¹Ø¨)ØŒ ÙˆÙ„ÙƒÙ† Ù‡Ø°Ù‡ Ø¶Ù…Ø§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ø«Ù„ ÙØµÙ„ Ø§Ù„Ø³Ù„Ø·Ø§Øª ÙˆØ§Ù„Ø¶ÙˆØ§Ø¨Ø· ÙˆØ§Ù„ØªÙˆØ§Ø²Ù†Ø§Øª."
                },
                'ambition': {
                    term_en: 'Ambition must be made to counteract ambition',
                    definition_en: "This is the big idea behind checks and balances. You have to use the natural selfishness and desire for power of one branch of government (like Congress) to fight the selfishness of another branch (like the President). This keeps any one part from getting too powerful.",
                    term_es: 'La ambiciÃ³n debe contrarrestar a la ambiciÃ³n',
                    definition_es: "Esta es la gran idea detrÃ¡s de los frenos y contrapesos. Tienes que usar el egoÃ­smo natural y el deseo de poder de una rama del gobierno (como el Congreso) para luchar contra el egoÃ­smo de otra rama (como el Presidente). Esto evita que una parte se vuelva demasiado poderosa.",
                    term_ar: 'ÙŠØ¬Ø¨ Ø¬Ø¹Ù„ Ø§Ù„Ø·Ù…ÙˆØ­ ÙŠÙˆØ§Ø¬Ù‡ Ø§Ù„Ø·Ù…ÙˆØ­',
                    definition_ar: "Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ÙˆØ±Ø§Ø¡ Ø§Ù„Ø¶ÙˆØ§Ø¨Ø· ÙˆØ§Ù„ØªÙˆØ§Ø²Ù†Ø§Øª. Ø¹Ù„ÙŠÙƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ù†Ø§Ù†ÙŠØ© Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© ÙˆØ§Ù„Ø±ØºØ¨Ø© ÙÙŠ Ø§Ù„Ø³Ù„Ø·Ø© Ù„ÙØ±Ø¹ ÙˆØ§Ø­Ø¯ Ù…Ù† Ø§Ù„Ø­ÙƒÙˆÙ…Ø© (Ù…Ø«Ù„ Ø§Ù„ÙƒÙˆÙ†ØºØ±Ø³) Ù„Ù…Ø­Ø§Ø±Ø¨Ø© Ø£Ù†Ø§Ù†ÙŠØ© ÙØ±Ø¹ Ø¢Ø®Ø± (Ù…Ø«Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³). Ù‡Ø°Ø§ ÙŠÙ…Ù†Ø¹ Ø£ÙŠ Ø¬Ø²Ø¡ Ù…Ù† Ø£Ù† ÙŠØµØ¨Ø­ Ù‚ÙˆÙŠÙ‹Ø§ Ø¬Ø¯Ù‹Ø§."
                }
            };
            const modal = document.getElementById('simplifier-modal');
            const modalTerm = document.getElementById('modal-term');
            const modalDefinition = document.getElementById('modal-definition');
            const modalClose = document.getElementById('modal-close');
            
            document.querySelectorAll('.simplifier-term').forEach(termEl => {
                termEl.addEventListener('click', () => {
                    const termKey = termEl.dataset.term;
                    if (simplifierTerms[termKey]) {
                        // *** This was the line with the typo. It's now fixed. ***
                        modalTerm.textContent = simplifierTerms[termKey]['term_' + currentLang];
                        modalDefinition.textContent = simplifierTerms[termKey]['definition_' + currentLang];
                        modal.classList.add('active');
                    }
                });
            });
            
            modalClose.addEventListener('click', () => modal.classList.remove('active'));
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });

            // --- Language Switching ---
            function setLanguage(lang) {
                currentLang = lang;
                
                // Set page direction
                document.documentElement.lang = lang;
                document.documentElement.dir = (lang === 'ar') ? 'rtl' : 'ltr';

                // Update all data-key elements
                document.querySelectorAll('[data-key]').forEach(el => {
                    const key = el.dataset.key;
                    if (translations[lang][key]) {
                        el.textContent = translations[lang][key];
                    }
                });

                // Update "Main Idea" button text (in case it's open)
                document.querySelectorAll('.main-idea-btn').forEach(button => {
                    const content = button.nextElementSibling;
                    const textSpan = button.querySelector('span');
                    if (content.classList.contains('hidden')) {
                        textSpan.textContent = translations[lang].show_main_idea;
                    } else {
                        textSpan.textContent = translations[lang].hide_main_idea;
                    }
                });
                
                // Update active language button
                document.querySelectorAll('.lang-btn-small').forEach(btn => {
                    if (btn.dataset.lang === lang) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });

                // NEW: Update placeholder text for notes
                const notesTextarea = document.getElementById('notes-textarea');
                if (notesTextarea) {
                    notesTextarea.placeholder = translations[lang].notes_placeholder;
                }
            }

            document.querySelectorAll('.lang-btn-small').forEach(btn => {
                btn.addEventListener('click', () => {
                    setLanguage(btn.dataset.lang);
                });
            });


            // --- Tab Switching ---
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelector('.tab-btn.active').classList.remove('active');
                    document.querySelector('.tab-content.active').classList.remove('active');
                    
                    tab.classList.add('active');
                    activeTab = tab.dataset.tab;
                    document.getElementById(activeTab).classList.add('active');
                });
            });

            // --- Main Idea Toggle ---
            document.querySelectorAll('.main-idea-btn').forEach(button => {
                const textSpan = button.querySelector('span');
                
                button.addEventListener('click', () => {
                    const content = button.nextElementSibling;
                    const isHidden = content.classList.contains('hidden');
                    
                    if (isHidden) {
                        content.classList.remove('hidden');
                        textSpan.textContent = translations[currentLang].hide_main_idea;
                    } else {
                        content.classList.add('hidden');
                        textSpan.textContent = translations[currentLang].show_main_idea;
                    }
                });
            });

            // --- Accessibility: Font Size ---
            let currentFontSize = 1.75; // in rem
            document.getElementById('font-increase').addEventListener('click', () => {
                currentFontSize = Math.min(currentFontSize + 0.25, 3.5); // Max 3.5rem
                document.documentElement.style.setProperty('--base-font-size', `${currentFontSize}rem`);
            });
            
            document.getElementById('font-decrease').addEventListener('click', () => {
                currentFontSize = Math.max(currentFontSize - 0.25, 1.25); // Min 1.25rem
                document.documentElement.style.setProperty('--base-font-size', `${currentFontSize}rem`);
            });

            // --- Accessibility: High Contrast ---
            document.getElementById('contrast-toggle').addEventListener('click', (e) => {
                appContainer.classList.toggle('high-contrast');
                e.currentTarget.classList.toggle('active-toggle');
            });

            // --- Accessibility: Reading Ruler ---
            const ruler = document.getElementById('reading-ruler');
            const rulerToggle = document.getElementById('reading-ruler-toggle');

            rulerToggle.addEventListener('click', () => {
                ruler.classList.toggle('active');
                rulerToggle.classList.toggle('active-toggle');
            });

            function moveRuler(e) {
                if (ruler.classList.contains('active')) {
                    const y = e.clientY || (e.touches && e.touches[0] ? e.touches[0].clientY : null);
                    if (y) {
                        ruler.style.top = `${y}px`;
                    }
                }
            }
            
            document.addEventListener('mousemove', moveRuler);
            document.addEventListener('touchmove', moveRuler);

            // --- Accessibility: Tools Toggle ---
            document.getElementById('tools-toggle-btn').addEventListener('click', () => {
                document.getElementById('tools-panel').classList.toggle('hidden');
            });

            // --- Accessibility: Text to Speech ---
            const synth = window.speechSynthesis;
            const speakBtn = document.getElementById('speak-btn');
            const stopBtn = document.getElementById('stop-btn');
            
            function speakText() {
                if (synth.speaking) {
                    synth.cancel(); 
                }
                const activeContent = document.getElementById(activeTab);
                if (activeContent) {
                    let textToSpeak = "";

                    // Get translated headers
                    const h2 = activeContent.querySelector('h2');
                    if (h2) textToSpeak += h2.textContent + ". ";

                    // Get translated "Main Idea" if visible
                    const mainIdeaContent = activeContent.querySelector('.main-idea-content');
                    if (mainIdeaContent && !mainIdeaContent.classList.contains('hidden')) {
                        textToSpeak += mainIdeaContent.textContent + ". ";
                    }

                    // Get the *original English source text*
                    // This is a deliberate choice to have it read the source.
                    activeContent.querySelectorAll('p[class*="mb-8"]').forEach(p => {
                        textToSpeak += p.textContent + " ";
                    });

                    // For questions tab, get all text
                    if (activeTab === 'questions') {
                         activeContent.querySelectorAll('h3, p, li').forEach(el => {
                             textToSpeak += el.textContent + ". ";
                         });
                    }
                    // For notes tab, read the notes
                    if (activeTab === 'notes') {
                        textToSpeak += document.getElementById('notes-textarea').value;
                    }


                    const utterance = new SpeechSynthesisUtterance(textToSpeak);
                    utterance.lang = currentLang; // Set the language for the synth
                    utterance.onerror = (event) => {
                        console.error('SpeechSynthesisUtterance.onerror', event);
                    };
                    synth.speak(utterance);
                    // *** FIX: Removed stray "Read text" string that was breaking the script ***
                }
            }
            
            function stopText() {
                synth.cancel();
            }

            speakBtn.addEventListener('click', speakText);
            stopBtn.addEventListener('click', stopText);

            tabs.forEach(tab => {
                tab.addEventListener('click', stopText);
            });
            
            // Stop speech when changing language
            document.querySelectorAll('.lang-btn-small').forEach(btn => {
                btn.addEventListener('click', stopText);
            });
            
            // --- NEW: Highlighter ---
            const highlighterToggle = document.getElementById('highlighter-toggle');
            let highlighterActive = false;
            
            highlighterToggle.addEventListener('click', () => {
                highlighterActive = !highlighterActive;
                highlighterToggle.classList.toggle('active-toggle');
                contentArea.style.cursor = highlighterActive ? 'copy' : 'default';
            });
            
            // This function handles highlighting text
            function highlightSelection(e) {
                if (!highlighterActive) return;
                
                // Don't highlight in notes or questions tabs
                if (activeTab === 'notes' || activeTab === 'questions') return;

                // Stop if we click a simplifier term or an already-highlighted span
                if (e.target.classList.contains('simplifier-term') || e.target.classList.contains('highlight')) {
                    return;
                }

                const selection = window.getSelection();
                if (selection.rangeCount > 0 && !selection.isCollapsed) {
                    const range = selection.getSelectionRange();
                    
                    // Check if selection is within the content area
                    if (!contentArea.contains(range.commonAncestorContainer)) return;
                    
                    const span = document.createElement('span');
                    span.className = 'highlight';
                    
                    // Add click event to un-highlight
                    span.onclick = () => {
                        if (!highlighterActive) { // Only unhighlight if highlighter is OFF
                             // Get the text content of the span
                            const text = span.textContent;
                            // Replace the span with its own text content
                            span.parentNode.replaceChild(document.createTextNode(text), span);
                            // Re-normalize the parent node to merge adjacent text nodes
                            span.parentNode.normalize();
                        }
                    };
                    
                    try {
                        range.surroundContents(span);
                    } catch (ex) {
                        console.warn("Could not wrap selection, likely spans boundaries. This is complex.", ex);
                    }
                    
                    selection.removeAllRanges(); // Clear selection after highlighting
                }
            }
            
            // Use 'mouseup' for desktop clicks and 'touchend' for mobile
            contentArea.addEventListener('mouseup', highlightSelection);
            contentArea.addEventListener('touchend', highlightSelection);

            // Initialize placeholders
            setLanguage(currentLang);

        });
    </script>
</body>
</html>



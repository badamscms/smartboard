<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Declaration Explorer</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Outfit (Google Sans alternative) & Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- CORE STYLES --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #1a202c;
            overflow: hidden;
            height: 100vh;
            display: flex;
            margin: 0; /* Reset margin */
        }
        
        .font-brand {
            font-family: 'Outfit', sans-serif; 
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 300px;
            background-color: #1e293b; /* Slate 800 */
            color: #cbd5e1;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #334155;
            flex-shrink: 0;
            z-index: 30;
            transition: transform 0.3s ease;
            position: relative;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                position: absolute;
                height: 100%;
                transform: translateX(-100%);
                box-shadow: 5px 0 15px rgba(0,0,0,0.5);
            }
            .sidebar.open {
                transform: translateX(0);
            }
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.875rem 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 4px solid transparent;
            font-size: 0.85rem;
            font-weight: 500;
            letter-spacing: 0.01em;
        }
        .nav-item:hover {
            background-color: #334155;
            color: white;
        }
        .nav-item.active {
            background-color: #334155;
            color: white;
            border-left-color: #facc15; /* Yellow-400 */
            background: linear-gradient(90deg, rgba(250, 204, 21, 0.1) 0%, rgba(0,0,0,0) 100%);
        }
        
        .nav-badge {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            background-color: #475569;
            color: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 700;
            margin-right: 1rem;
            transition: all 0.2s;
            flex-shrink: 0;
            font-family: 'Outfit', sans-serif;
        }
        .nav-item.active .nav-badge {
            background-color: #facc15;
            color: #0f172a;
            box-shadow: 0 0 10px rgba(250, 204, 21, 0.4);
        }

        /* --- MAIN STAGE --- */
        .main-stage {
            flex-grow: 1;
            position: relative;
            background-color: #334155;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise' x='0' y='0'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.1'/%3E%3C/svg%3E");
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            overflow: hidden;
        }

        #slides-container {
            width: 100%;
            display: flex;
            justify-content: center;
        }

        /* --- SLIDE --- */
        .slide {
            /* Default State: Hidden and Removed from Layout */
            display: none;
            
            background-color: #f8fafc;
            width: 100%;
            max-width: 64rem; 
            height: auto;
            max-height: 90vh;
            aspect-ratio: 16/9; 
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6);
            flex-direction: column;
            overflow: hidden;
        }
        
        @media (max-width: 1024px), (max-height: 800px) {
            .slide {
                aspect-ratio: auto;
                height: 90%;
                width: 95%;
            }
        }

        /* Active State: Visible */
        .slide.active {
            display: flex;
            animation: fadeUp 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: scale(0.95) translateY(30px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        /* Slide Content */
        .slide-header {
            padding: 1.5rem 2.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: flex-start;
            background-color: #ffffff;
        }

        .big-letter {
            font-family: 'Outfit', sans-serif;
            font-size: 3.5rem;
            font-weight: 800;
            color: #0f172a; 
            line-height: 1;
            margin-right: 1.5rem;
            letter-spacing: -0.02em;
        }

        .slide-body {
            padding: 2rem 3rem;
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        /* Scrollbar */
        .slide-body::-webkit-scrollbar { width: 8px; }
        .slide-body::-webkit-scrollbar-track { background: transparent; }
        .slide-body::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }

        /* --- CONTROLS --- */
        .controls-bar {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(15, 23, 42, 0.9);
            padding: 0.5rem 1.5rem;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.5);
            z-index: 50;
            backdrop-filter: blur(4px);
        }

        .control-btn {
            color: white;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05);
        }
        .control-btn:hover:not(:disabled) {
            background-color: white;
            color: #0f172a;
            transform: scale(1.1);
        }
        .control-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        /* --- INTERACTION --- */
        .vocab-word {
            background-color: #bae6fd;
            border-bottom: 2px solid #0284c7;
            cursor: pointer;
            padding: 0 2px;
            font-weight: 600;
            color: #0c4a6e;
            transition: all 0.2s;
            border-radius: 4px;
        }
        .vocab-word:hover { background-color: #38bdf8; color: white; }

        .text-original {
            font-family: 'Inter', sans-serif;
            font-size: 1.25rem;
            line-height: 1.7;
            color: #334155;
            font-weight: 400;
        }

        .modern-text {
            display: none;
            color: #0f172a;
            line-height: 1.7;
            font-size: 1.25rem;
            font-weight: 500;
            font-family: 'Inter', sans-serif;
        }
        .show-modern .modern-text { display: block; }
        .show-modern .original-text { display: none; }
        
        .slide-actions { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; }
        .action-pill {
            display: flex; align-items: center; gap: 0.5rem;
            padding: 0.5rem 1rem; border-radius: 9999px;
            font-size: 0.875rem; font-weight: 600;
            transition: all 0.2s; cursor: pointer;
            border: 1px solid #e2e8f0; background-color: white; color: #475569;
        }
        .action-pill:hover { background-color: #f1f5f9; border-color: #cbd5e1; }
        
        .tag-badge {
            font-size: 0.7rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.05em; padding: 0.25rem 0.6rem;
            border-radius: 4px; background-color: #f1f5f9; color: #64748b;
        }

        /* --- MODAL --- */
        .modal-backdrop {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(8px); z-index: 100;
            display: none; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s ease;
        }
        .modal-backdrop.open { display: flex; opacity: 1; }

        .modal-card {
            background-color: white; width: 90%; max-width: 450px;
            border-radius: 1.5rem; padding: 2.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            transform: scale(0.95) translateY(20px);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .modal-backdrop.open .modal-card { transform: scale(1) translateY(0); }
        
    </style>
</head>
<body>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="p-6 border-b border-gray-700 flex flex-col gap-1">
            <h1 class="text-2xl font-bold text-white font-brand flex items-center gap-3 tracking-tight">
                <i data-lucide="feather" class="text-yellow-400 w-6 h-6"></i>
                Declaration
            </h1>
            <p class="text-xs text-gray-400 uppercase tracking-widest ml-9 font-semibold">Interactive Parser</p>
        </div>

        <!-- Mode Toggle -->
        <div class="px-6 py-6 border-b border-gray-700/50">
            <div class="flex items-center justify-between bg-gray-900 p-1.5 rounded-xl cursor-pointer group border border-gray-700" onclick="toggleModernMode()">
                <div id="side-label-1776" class="w-1/2 text-center text-xs font-bold text-yellow-400 px-2 py-2.5 rounded-lg bg-gray-800 shadow transition-all uppercase tracking-wide font-brand">1776</div>
                <div id="side-label-modern" class="w-1/2 text-center text-xs font-bold text-gray-500 px-2 py-2.5 rounded-lg transition-all group-hover:text-gray-300 uppercase tracking-wide font-brand">Modern</div>
            </div>
            <p class="text-[11px] text-gray-500 mt-3 text-center font-medium">Click above to translate</p>
        </div>

        <!-- Nav List -->
        <div class="flex-1 overflow-y-auto py-2 space-y-1" id="nav-list">
            <!-- Injected JS -->
        </div>

        <!-- Shortcuts Hint -->
        <div class="p-4 border-t border-gray-700/50 text-center">
            <p class="text-[10px] text-gray-500 flex items-center justify-center gap-2">
                <span class="bg-gray-700 px-1.5 py-0.5 rounded text-gray-300 font-mono">←</span>
                <span class="bg-gray-700 px-1.5 py-0.5 rounded text-gray-300 font-mono">→</span>
                to navigate
            </p>
        </div>
    </div>

    <!-- Main Stage -->
    <div class="main-stage">
        
        <!-- Mobile Menu Trigger -->
        <button class="md:hidden absolute top-4 left-4 text-white z-30 bg-gray-800 p-3 rounded-xl shadow-lg" onclick="toggleSidebar()">
            <i data-lucide="menu"></i>
        </button>

        <!-- Slides Container -->
        <div id="slides-container">
            <!-- Slides Injected Here -->
        </div>

        <!-- Floating Controls -->
        <div class="controls-bar">
            <button class="control-btn" onclick="prevSlide()" id="btn-prev" title="Previous Slide">
                <i data-lucide="chevron-left"></i>
            </button>
            <span class="text-sm font-brand text-gray-300 font-bold min-w-[4rem] text-center select-none" id="slide-counter">
                1 / 11
            </span>
            <button class="control-btn" onclick="nextSlide()" id="btn-next" title="Next Slide">
                <i data-lucide="chevron-right"></i>
            </button>
        </div>

    </div>

    <!-- Vocab Modal -->
    <div id="vocab-modal" class="modal-backdrop" onclick="closeModal()">
        <div class="modal-card" onclick="event.stopPropagation()">
            <div class="flex justify-between items-start mb-4">
                <h3 id="modal-word" class="text-3xl font-brand font-bold text-slate-900 capitalize tracking-tight">Word</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 border-none bg-transparent cursor-pointer p-2 rounded-full hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div class="h-1.5 w-12 bg-sky-500 mb-6 rounded-full"></div>
            <p id="modal-def" class="text-lg text-slate-600 leading-relaxed font-medium">Definition goes here.</p>
            <div class="mt-8 flex justify-end">
                <button onclick="closeModal()" class="bg-slate-900 hover:bg-slate-800 text-white font-bold py-3 px-6 rounded-xl transition-colors cursor-pointer text-sm tracking-wide font-brand">
                    Got it
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const declarationSections = [
            {
                id: 'A',
                title: 'The Introduction',
                original: "When in the Course of human events, it becomes necessary for one people to dissolve the political bands which have connected them with another, and to assume among the powers of the earth, the separate and equal station to which the Laws of Nature and of Nature's God entitle them, a decent respect to the opinions of mankind requires that they should declare the causes which impel them to the separation.",
                modern: "Sometimes in history, a group of people needs to separate themselves from the country they were part of. They need to become an independent country, equal to all others, as natural law allows. Out of respect for the rest of the world, they should explain exactly why they are leaving.",
                analysis: "This sets the stage. Jefferson is saying, \"We are breaking up, and we owe the world an explanation why.\"",
                tags: ["Introduction", "Philosophy"],
                vocab: {
                "dissolve": "To end or close down.",
                "impel": "To force or drive someone to do something.",
                "station": "Status or position.",
                "entitle": "To give a right to."
                }
            },
            {
                id: 'B',
                title: 'The Preamble',
                original: "We hold these truths to be self-evident, that all men are created equal, that they are endowed by their Creator with certain unalienable Rights, that among these are Life, Liberty and the pursuit of Happiness.--That to secure these rights, Governments are instituted among Men, deriving their just powers from the consent of the governed, --That whenever any Form of Government becomes destructive of these ends, it is the Right of the People to alter or to abolish it, and to institute new Government...",
                modern: "Ideally, it is obvious that everyone is equal and has rights given by God that cannot be taken away: Life, Freedom, and the chance to be happy. Governments exist only to protect these rights, and they only have power because the people say so. If a government starts destroying these rights, the people have the right to change it or get rid of it.",
                analysis: "The core philosophy. 1. Rights come from God/Nature, not the King. 2. Government works for the people (Consent of the Governed).",
                tags: ["Rights", "Core Values"],
                vocab: {
                "self-evident": "Obvious; needing no explanation.",
                "unalienable": "Cannot be taken away or denied.",
                "endowed": "Given or provided with.",
                "consent": "Permission or agreement.",
                "abolish": "To formally put an end to something."
                }
            },
            {
                id: 'C',
                title: 'Right to Revolution',
                original: "Prudence, indeed, will dictate that Governments long established should not be changed for light and transient causes... But when a long train of abuses and usurpations, pursuing invariably the same Object evinces a design to reduce them under absolute Despotism, it is their right, it is their duty, to throw off such Government, and to provide new Guards for their future security.",
                modern: "Wisdom tells us not to change governments for small reasons. But when a government abuses its power over and over again to create a tyranny, it is not just the people's right but their duty to overthrow it.",
                analysis: "Jefferson admits revolution is serious business. It shouldn't be done for small reasons, but the King's abuse has gone on too long.",
                tags: ["Revolution", "Duty"],
                vocab: {
                "prudence": "Cautiousness; good judgment.",
                "transient": "Lasting only for a short time.",
                "usurpations": "Taking power by force.",
                "despotism": "Absolute power or tyranny.",
                "evinces": "Clearly shows or reveals."
                }
            },
            {
                id: 'D',
                title: 'Grievances: Laws',
                original: "He has refused his Assent to Laws, the most wholesome and necessary for the public good... He has forbidden his Governors to pass Laws of immediate and pressing importance... He has dissolved Representative Houses repeatedly... He has refused for a long time, after such dissolutions, to cause others to be elected...",
                modern: "The King has refused to sign laws that we need. He has fired our determined representatives and refused to let us elect new ones, leaving us vulnerable to invasion and chaos.",
                analysis: "The 'He' is King George III. This section lists how the King stopped the colonies from governing themselves.",
                tags: ["Grievance", "Legislation"],
                vocab: {
                "assent": "Official approval or agreement.",
                "relinquish": "To give up.",
                "annihilation": "Complete destruction.",
                "convulsions": "Violent political turmoil."
                }
            },
            {
                id: 'E',
                title: 'Grievances: Courts',
                original: "He has obstructed the Administration of Justice, by refusing his Assent to Laws for establishing Judiciary powers. He has made Judges dependent on his Will alone, for the tenure of their offices, and the amount and payment of their salaries. He has erected a multitude of New Offices, and sent hither swarms of Officers to harrass our people, and eat out their substance.",
                modern: "He has blocked our justice system by refusing to let us set up courts. He controls our judges by being the only one who pays them. He has sent swarms of new government officials to harass us and eat our food.",
                analysis: "The King controlled the courts (making judges biased) and sent soldiers/officials to live off the colonists' resources.",
                tags: ["Grievance", "Justice", "Economy"],
                vocab: {
                "naturalization": "Becoming a citizen.",
                "tenure": "The period a job lasts.",
                "multitude": "A large number.",
                "substance": "Wealth, resources, or food."
                }
            },
            {
                id: 'F',
                title: 'Grievances: Army',
                original: "He has kept among us, in times of peace, Standing Armies without the Consent of our legislatures. He has affected to render the Military independent of and superior to the Civil power... For Quartering large bodies of armed troops among us...",
                modern: "He keeps armies here even when there is no war, without our permission. He thinks the military is more important than our local government. He forces us to house soldiers in our homes.",
                analysis: "A direct attack on the Quartering Act and the presence of British troops who were essentially occupying American cities.",
                tags: ["Grievance", "Military"],
                vocab: {
                "standing armies": "Permanent armies stationed in a country.",
                "quartering": "Housing soldiers.",
                "mock trial": "A fake or unfair trial.",
                "civil power": "The regular government (not military)."
                }
            },
            {
                id: 'G',
                title: 'Grievances: Taxes',
                original: "For cutting off our Trade with all parts of the world: For imposing Taxes on us without our Consent: For depriving us in many cases, of the benefits of Trial by Jury: For transporting us beyond Seas to be tried for pretended offences...",
                modern: "He stopped us from trading with the rest of the world. He taxes us without our permission. He takes away our right to a trial by a jury of our peers. He sends us across the ocean to England to stand trial for fake crimes.",
                analysis: "Referencing the Intolerable Acts. 'Taxation without representation' is the famous theme here.",
                tags: ["Grievance", "Economy", "Taxes"],
                vocab: {
                "imposing": "Forcing something to be accepted.",
                "depriving": "Taking something away from someone.",
                "arbitrary": "Based on random choice or whim."
                }
            },
            {
                id: 'H',
                title: 'Grievances: Violence',
                original: "He has abdicated Government here, by declaring us out of his Protection and waging War against us. He has plundered our seas, ravaged our Coasts, burnt our towns, and destroyed the lives of our people. He is at this time transporting large Armies of foreign Mercenaries to compleat the works of death...",
                modern: "He has given up his right to rule us by declaring war on us. He burns our towns, ruins our trade, and kills our people. He is hiring foreign soldiers (Mercenaries) to come here and kill us with cruelty.",
                analysis: "The King is no longer a ruler; he is an enemy waging war. Mentions 'Hessians' (German mercenaries) and controversial frontier warfare.",
                tags: ["Grievance", "War", "Violence"],
                vocab: {
                "abdicated": "Renounced or gave up power.",
                "plundered": "Stolen goods using force.",
                "mercenaries": "Soldiers hired to fight for a foreign army.",
                "perfidy": "Deceitfulness; untrustworthiness.",
                "insurrections": "Violent uprisings."
                }
            },
            {
                id: 'I',
                title: 'Failed Petitions',
                original: "In every stage of these Oppressions We have Petitioned for Redress in the most humble terms: Our repeated Petitions have been answered only by repeated injury. A Prince whose character is thus marked by every act which may define a Tyrant, is unfit to be the ruler of a free people.",
                modern: "Every time he did something bad, we asked nicely for him to stop. He just hit us harder. A ruler who acts like a tyrant is not fit to rule free people.",
                analysis: "The 'Olive Branch Petition.' They tried to solve this peacefully, but the King ignored them.",
                tags: ["Action", "Petition", "Tyranny"],
                vocab: {
                "oppressions": "Cruel and unfair treatment.",
                "redress": "Remedy for a wrong.",
                "tyrant": "A cruel and oppressive ruler."
                }
            },
            {
                id: 'J',
                title: 'British Brethren',
                original: "Nor have We been wanting in attentions to our Brittish brethren. We have warned them from time to time... We have appealed to their native justice and magnanimity... They too have been deaf to the voice of justice and of consanguinity. We must, therefore, acquiesce in the necessity, which denounces our Separation, and hold them, as we hold the rest of mankind, Enemies in War, in Peace Friends.",
                modern: "We didn't just blame the King; we told the British people too. We warned them that their Parliament was treating us unfairly. But they ignored us too. So, we have to separate. They are now just like any other country: enemies when we are at war, friends when we are at peace.",
                analysis: "They appealed to the British people as 'brothers' (consanguinity), but were ignored. The emotional break is complete.",
                tags: ["Betrayal", "Relationship"],
                vocab: {
                "jurisdiction": "Official power to make decisions.",
                "magnanimity": "Generosity.",
                "consanguinity": "Blood relation.",
                "acquiesce": "Accept reluctantly."
                }
            },
            {
                id: 'K',
                title: 'The Declaration',
                original: "We, therefore, the Representatives of the United States of America... solemnly publish and declare, That these United Colonies are, and of Right ought to be Free and Independent States... And for the support of this Declaration, with a firm reliance on the protection of divine Providence, we mutually pledge to each other our Lives, our Fortunes and our sacred Honor.",
                modern: "Therefore, we representatives of the USA declare that we are Free and Independent States. We are no longer part of Britain. Relying on God's protection, we promise each other our lives, our wealth, and our honor to defend this independence.",
                analysis: "The actual legal declaration. They are now 'States', not 'Colonies'. The famous final pledge underlines the risk they are taking (treason).",
                tags: ["Independence", "Pledge", "Conclusion"],
                vocab: {
                "absolved": "Set free from blame.",
                "allegiance": "Loyalty to a superior.",
                "providence": "Protective care of God.",
                "pledge": "A solemn promise.",
                "rectitude": "Morally correct behavior."
                }
            }
        ];

        // --- STATE & HELPERS ---
        let isModern = false;
        let currentSlide = 0;
        let vocabMap = {};

        // --- RENDER ---
        function renderSidebar() {
            const container = document.getElementById('nav-list');
            container.innerHTML = declarationSections.map((section, index) => `
                <div class="nav-item ${index === 0 ? 'active' : ''}" onclick="goToSlide(${index})" id="nav-item-${index}">
                    <div class="nav-badge">${section.id}</div>
                    <div class="text-sm font-medium truncate">${section.title}</div>
                </div>
            `).join('');
        }

        function processText(text, vocab) {
            if (!vocab) return text;
            let processed = text;
            const sortedVocab = Object.keys(vocab).sort((a, b) => b.length - a.length);
            
            sortedVocab.forEach(word => {
                vocabMap[word.toLowerCase()] = vocab[word];
                const regex = new RegExp(`\\b(${word})\\b`, 'gi');
                // Use data attribute for clicking
                processed = processed.replace(regex, (match) => {
                    return `<span class="vocab-word" data-word="${word.toLowerCase()}" onclick="handleVocabClick(event)">${match}</span>`;
                });
            });
            return processed;
        }

        function renderSlides() {
            const container = document.getElementById('slides-container');
            container.innerHTML = declarationSections.map((section, index) => {
                const processed = processText(section.original, section.vocab);
                
                // Create tag HTML
                const tagsHtml = (section.tags || []).map(tag => 
                    `<span class="tag-badge">${tag}</span>`
                ).join('');

                return `
                <div class="slide ${index === 0 ? 'active' : ''}" id="slide-${index}">
                    <div class="slide-header">
                        <div class="big-letter">${section.id}</div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between">
                                <h2 class="text-3xl font-brand font-bold text-slate-900 tracking-tight">${section.title}</h2>
                                <div class="flex gap-2">${tagsHtml}</div>
                            </div>
                            <p class="text-slate-500 text-sm mt-2 flex items-center font-medium">
                                <i data-lucide="graduation-cap" class="w-4 h-4 mr-2 text-sky-600"></i>
                                <span class="text-sky-700">Analysis:</span>&nbsp;${section.analysis}
                            </p>
                        </div>
                    </div>
                    <div class="slide-body">
                        
                        <!-- Actions -->
                        <div class="slide-actions">
                            <button class="action-pill" onclick="speakText(${index})">
                                <i data-lucide="volume-2" class="w-4 h-4"></i> Read Aloud
                            </button>
                            <button class="action-pill" onclick="copyText(${index})">
                                <i data-lucide="copy" class="w-4 h-4"></i> Copy Text
                            </button>
                        </div>

                        <div class="original-text font-sans text-xl leading-loose text-slate-700" id="text-original-${index}">
                            ${processed}
                        </div>
                        <div class="modern-text" id="text-modern-${index}">
                            ${section.modern}
                        </div>
                    </div>
                </div>
                `;
            }).join('');
        }

        // --- INTERACTIONS ---
        function toggleModernMode() {
            isModern = !isModern;
            const body = document.body;
            const btn1776 = document.getElementById('side-label-1776');
            const btnModern = document.getElementById('side-label-modern');
            
            if(isModern) {
                body.classList.add('show-modern');
                btn1776.className = "w-1/2 text-center text-xs font-bold text-gray-500 px-2 py-2.5 rounded-lg transition-all cursor-pointer hover:text-gray-300 uppercase tracking-wide font-brand";
                btnModern.className = "w-1/2 text-center text-xs font-bold text-white px-2 py-2.5 rounded-lg bg-sky-600 shadow transition-all uppercase tracking-wide font-brand";
            } else {
                body.classList.remove('show-modern');
                btn1776.className = "w-1/2 text-center text-xs font-bold text-yellow-400 px-2 py-2.5 rounded-lg bg-gray-800 shadow transition-all uppercase tracking-wide font-brand";
                btnModern.className = "w-1/2 text-center text-xs font-bold text-gray-500 px-2 py-2.5 rounded-lg transition-all cursor-pointer hover:text-gray-300 uppercase tracking-wide font-brand";
            }
        }

        function goToSlide(index) {
            // Stop speaking if changing slide
            window.speechSynthesis.cancel();

            // Update Slide Visibility
            document.querySelectorAll('.slide').forEach((el, idx) => {
                if (idx === index) el.classList.add('active');
                else el.classList.remove('active');
            });

            // Update Sidebar Active State
            document.querySelectorAll('.nav-item').forEach((el, idx) => {
                if (idx === index) el.classList.add('active');
                else el.classList.remove('active');
            });

            // Scroll nav item into view if needed
            const activeNav = document.getElementById(`nav-item-${index}`);
            if(activeNav) activeNav.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            currentSlide = index;
            updateControls();
        }

        function nextSlide() {
            if (currentSlide < declarationSections.length - 1) goToSlide(currentSlide + 1);
        }
        function prevSlide() {
            if (currentSlide > 0) goToSlide(currentSlide - 1);
        }

        function updateControls() {
            document.getElementById('slide-counter').innerText = `${currentSlide + 1} / ${declarationSections.length}`;
            document.getElementById('btn-prev').disabled = currentSlide === 0;
            document.getElementById('btn-next').disabled = currentSlide === declarationSections.length - 1;
        }

        // --- TTS & COPY ---
        function speakText(index) {
            window.speechSynthesis.cancel(); // Stop any current speech
            
            const text = isModern 
                ? declarationSections[index].modern 
                : declarationSections[index].original;

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.9; // Slightly slower for dramatic effect
            
            // Try to find a nice English voice
            const voices = window.speechSynthesis.getVoices();
            const preferredVoice = voices.find(voice => voice.name.includes("Google US English") || voice.name.includes("Samantha"));
            if (preferredVoice) utterance.voice = preferredVoice;

            window.speechSynthesis.speak(utterance);
        }

        function copyText(index) {
            const text = isModern 
                ? declarationSections[index].modern 
                : declarationSections[index].original;
            
            navigator.clipboard.writeText(text).then(() => {
                alert("Text copied to clipboard!");
            });
        }

        function handleVocabClick(event) {
            event.stopPropagation();
            const word = event.target.getAttribute('data-word');
            const definition = vocabMap[word];
            
            if (definition) {
                document.getElementById('modal-word').innerText = event.target.innerText;
                document.getElementById('modal-def').innerText = definition;
                
                const modal = document.getElementById('vocab-modal');
                modal.classList.add('open');
            }
        }

        function closeModal() {
            const modal = document.getElementById('vocab-modal');
            modal.classList.remove('open');
        }
        
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // Keyboard Support
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextSlide();
            if (e.key === 'ArrowLeft') prevSlide();
            if (e.key === 'Escape') closeModal();
        });

        // --- INIT ---
        window.onload = () => {
            renderSidebar();
            renderSlides();
            updateControls();
            lucide.createIcons();
        };
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Who Rules? - Interactive Smartboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Tailwind gray-900 */
            color: #F9FAFB; /* Tailwind gray-50 */
        }
        .flowchart-line {
            position: relative;
            z-index: 0;
        }
        .flowchart-line::before {
            content: '';
            position: absolute;
            background-color: #4B5563; /* Tailwind gray-600 */
            z-index: -1;
        }
        /* Vertical lines */
        .line-v::before {
            left: 50%;
            width: 4px;
            top: -20px;
            height: 20px;
            transform: translateX(-50%);
        }
         /* Horizontal lines */
        .line-h::before {
            top: 50%;
            height: 4px;
            left: -20px;
            width: 20px;
            transform: translateY(-50%);
        }
        .main-line::before {
            top: 50%;
            height: 4px;
            left: 0;
            right: 0;
            transform: translateY(-50%);
        }
        .category-node .sub-nodes {
            display: none;
        }
        .category-node.open .sub-nodes {
            display: flex;
        }
        .modal-backdrop {
            background-color: rgba(0,0,0,0.75);
        }
        .scenario-card {
            touch-action: none;
        }
        .drop-zone {
            border: 3px dashed #4B5563;
        }
        .drop-zone.drag-over {
            border-color: #3B82F6;
            background-color: #1F2937;
        }
        .drop-zone.correct {
            border-color: #22C55E;
            background-color: #143621;
        }
        .drop-zone.incorrect {
            border-color: #EF4444;
            background-color: #450a0a;
        }
        .draggable-item {
            cursor: grab;
        }
        .draggable-item:active {
            cursor: grabbing;
        }
        .draggable-item.dragging {
            opacity: 0.5;
            transform: scale(1.05);
        }
        /* Compare Tool */
        .compare-item.selected {
            background-color: #3B82F6;
            border-color: #60A5FA;
            color: white;
        }
        .compare-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Timeline */
        .timeline-container {
            position: relative;
            padding: 2rem 0;
        }
        .timeline-container::before {
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: 0;
            width: 4px;
            height: 100%;
            background-color: #4B5563;
        }
        .timeline-item {
            position: relative;
            width: 50%;
            padding: 0 2rem;
        }
        .timeline-item:nth-child(odd) {
            left: 0;
            padding-left: 5rem;
        }
        .timeline-item:nth-child(even) {
            left: 50%;
            padding-right: 5rem;
        }
        .timeline-item::after {
            content: '';
            position: absolute;
            top: 1rem;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #F9FAFB;
            border: 4px solid #4B5563;
        }
        .timeline-item:nth-child(odd)::after {
            right: -10px;
        }
         .timeline-item:nth-child(even)::after {
            left: -10px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 lg:p-8 overflow-hidden">

    <div id="app-container" class="w-full h-full flex flex-col items-center">
        <!-- Header -->
        <header class="text-center mb-8 lg:mb-16">
            <h1 class="text-4xl md:text-5xl lg:text-7xl font-black tracking-tight text-white">Who Rules?</h1>
            <p class="text-lg md:text-xl lg:text-2xl text-gray-400 mt-2">An Interactive Guide to Forms of Government</p>
        </header>

        <!-- Main Flowchart Hub -->
        <main id="flowchart-hub" class="flex flex-col items-center w-full">
            <div class="relative mb-8">
                 <div class="absolute top-1/2 left-0 w-full h-1 bg-gray-600" style="transform: translateY(-50%);"></div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 md:gap-12 lg:gap-20 w-full max-w-7xl">
                <!-- Category: NONE -->
                <div class="category-node flex flex-col items-center" data-category="none">
                    <button class="main-category-btn text-3xl font-bold bg-gray-800 border-2 border-gray-600 rounded-2xl py-6 px-12 transition-transform transform hover:scale-105 hover:bg-gray-700 w-full">üö´ NONE</button>
                    <div class="sub-nodes mt-6 w-full">
                        <div class="flex flex-col items-center w-full space-y-4">
                            <div class="flowchart-line line-v"></div>
                            <button class="sub-node-btn text-2xl bg-blue-600 rounded-xl py-4 px-8 w-full transition-transform transform hover:scale-105 hover:bg-blue-500" data-gov="anarchy">üö´ Anarchy</button>
                        </div>
                    </div>
                </div>

                <!-- Category: ONE -->
                <div class="category-node flex flex-col items-center" data-category="one">
                    <button class="main-category-btn text-3xl font-bold bg-gray-800 border-2 border-gray-600 rounded-2xl py-6 px-12 transition-transform transform hover:scale-105 hover:bg-gray-700 w-full">üë§ ONE</button>
                    <div class="sub-nodes mt-6 w-full">
                        <div class="flex flex-col items-center w-full space-y-4">
                            <div class="flowchart-line line-v"></div>
                            <button class="sub-node-btn text-2xl bg-purple-600 rounded-xl py-4 px-8 w-full transition-transform transform hover:scale-105 hover:bg-purple-500" data-gov="monarchy">üëë Monarchy</button>
                            <button class="sub-node-btn text-2xl bg-purple-600 rounded-xl py-4 px-8 w-full transition-transform transform hover:scale-105 hover:bg-purple-500" data-gov="dictatorship">üéñÔ∏è Dictatorship</button>
                        </div>
                    </div>
                </div>

                <!-- Category: FEW -->
                <div class="category-node flex flex-col items-center" data-category="few">
                    <button class="main-category-btn text-3xl font-bold bg-gray-800 border-2 border-gray-600 rounded-2xl py-6 px-12 transition-transform transform hover:scale-105 hover:bg-gray-700 w-full">üë• FEW</button>
                     <div class="sub-nodes mt-6 w-full">
                        <div class="flex flex-col items-center w-full space-y-4">
                            <div class="flowchart-line line-v"></div>
                            <button class="sub-node-btn text-2xl bg-red-600 rounded-xl py-4 px-8 w-full transition-transform transform hover:scale-105 hover:bg-red-500" data-gov="oligarchy">üë• Oligarchy</button>
                        </div>
                    </div>
                </div>

                <!-- Category: ALL -->
                <div class="category-node flex flex-col items-center" data-category="all">
                    <button class="main-category-btn text-3xl font-bold bg-gray-800 border-2 border-gray-600 rounded-2xl py-6 px-12 transition-transform transform hover:scale-105 hover:bg-gray-700 w-full">üåç ALL</button>
                     <div class="sub-nodes mt-6 w-full">
                        <div class="flex flex-col items-center w-full space-y-4">
                            <div class="flowchart-line line-v"></div>
                            <button class="sub-node-btn text-xl bg-green-600 rounded-xl py-4 px-6 w-full transition-transform transform hover:scale-105 hover:bg-green-500" data-gov="directDemocracy">üôã‚Äç‚ôÄÔ∏è Direct Democracy</button>
                             <button class="sub-node-btn text-xl bg-green-600 rounded-xl py-4 px-6 w-full transition-transform transform hover:scale-105 hover:bg-green-500" data-gov="representativeDemocracy">üó≥Ô∏è Representative Democracy</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Special Buttons -->
        <footer class="mt-12 lg:mt-20 flex flex-wrap justify-center gap-6">
             <button class="special-topic-btn text-xl font-bold bg-yellow-500 text-gray-900 rounded-2xl py-4 px-8 transition-transform transform hover:scale-105 hover:bg-yellow-400" data-gov="theocracy">
                ‚ú® Where does Theocracy fit?
            </button>
            <button id="compare-btn" class="text-xl font-bold bg-cyan-600 text-white rounded-2xl py-4 px-8 transition-transform transform hover:scale-105 hover:bg-cyan-500">
                ‚öñÔ∏è Compare Governments
            </button>
             <button id="timeline-btn" class="text-xl font-bold bg-rose-600 text-white rounded-2xl py-4 px-8 transition-transform transform hover:scale-105 hover:bg-rose-500">
                üìú Historical Timeline
            </button>
            <button id="test-knowledge-btn" class="text-xl font-bold bg-indigo-600 text-white rounded-2xl py-4 px-8 transition-transform transform hover:scale-105 hover:bg-indigo-500">
                üéÆ Test Your Knowledge
            </button>
        </footer>
    </div>

    <!-- Info Modal -->
    <div id="info-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div id="modal-content" class="bg-gray-800 border-2 border-gray-600 w-full max-w-4xl max-h-[90vh] rounded-3xl shadow-2xl flex flex-col transition-transform transform scale-95">
            <header class="p-6 flex justify-between items-center border-b border-gray-700">
                <h2 id="modal-title" class="text-4xl font-black">Government Type</h2>
                <button id="modal-close-btn" class="text-4xl text-gray-400 hover:text-white">&times;</button>
            </header>
            <main class="p-8 overflow-y-auto flex-grow">
                <div class="grid grid-cols-1 gap-8">
                    <div>
                        <p id="modal-definition" class="text-2xl font-light mb-6 bg-gray-900 p-4 rounded-lg"></p>
                        <h3 class="text-2xl font-bold mb-3">Key Characteristics:</h3>
                        <ul id="modal-characteristics" class="text-xl list-disc list-inside space-y-2">
                            <!-- Characteristics will be injected here -->
                        </ul>
                        <div id="modal-pros-container" class="mt-6">
                            <h3 class="text-2xl font-bold mb-3 text-green-400">Strengths:</h3>
                            <ul id="modal-pros" class="text-xl list-disc list-inside space-y-2">
                                <!-- Pros will be injected here -->
                            </ul>
                        </div>
                        <div id="modal-cons-container" class="mt-6">
                            <h3 class="text-2xl font-bold mb-3 text-red-400">Challenges:</h3>
                            <ul id="modal-cons" class="text-xl list-disc list-inside space-y-2">
                                <!-- Cons will be injected here -->
                            </ul>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Compare Modal -->
    <div id="compare-modal" class="fixed inset-0 z-50 flex flex-col items-center justify-center p-4 modal-backdrop hidden">
        <div class="bg-gray-800 border-2 border-gray-600 w-full max-w-7xl h-[90vh] rounded-3xl shadow-2xl flex flex-col relative">
            <header class="p-6 flex justify-between items-center border-b border-gray-700">
                <h2 class="text-3xl font-black">Compare & Contrast Governments</h2>
                <button id="compare-close-btn" class="text-4xl text-gray-400 hover:text-white">&times;</button>
            </header>
            <main class="p-8 flex-grow flex flex-col gap-4">
                <div class="text-center">
                    <p class="text-xl text-gray-300">Select two forms of government to compare them side-by-side.</p>
                    <button id="compare-reset-btn" class="mt-2 bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">Reset Selection</button>
                </div>
                <div class="flex-grow grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div id="compare-col-1" class="bg-gray-900 p-4 rounded-lg flex flex-col gap-2"></div>
                    <div id="compare-col-2" class="bg-gray-900 p-4 rounded-lg flex flex-col gap-2"></div>
                </div>
                <div id="compare-results" class="mt-4"></div>
            </main>
        </div>
    </div>

    <!-- Timeline Modal -->
    <div id="timeline-modal" class="fixed inset-0 z-50 flex flex-col items-center justify-center p-4 modal-backdrop hidden">
        <div class="bg-gray-800 border-2 border-gray-600 w-full max-w-5xl h-[90vh] rounded-3xl shadow-2xl flex flex-col relative">
            <header class="p-6 flex justify-between items-center border-b border-gray-700">
                <h2 class="text-3xl font-black">A Brief Historical Timeline</h2>
                <button id="timeline-close-btn" class="text-4xl text-gray-400 hover:text-white">&times;</button>
            </header>
            <main class="p-8 flex-grow overflow-y-auto">
                <div id="timeline-container" class="timeline-container">
                    <!-- Timeline items will be injected here -->
                </div>
            </main>
        </div>
    </div>
    
    <!-- Activity Modal -->
    <div id="activity-modal" class="fixed inset-0 z-50 flex flex-col items-center justify-center p-4 modal-backdrop hidden">
        <div class="bg-gray-800 border-2 border-gray-600 w-full max-w-7xl h-[90vh] rounded-3xl shadow-2xl flex flex-col relative">
             <header class="p-6 flex justify-between items-center border-b border-gray-700">
                <h2 class="text-3xl font-black">Classify the Government</h2>
                <button id="activity-close-btn" class="text-4xl text-gray-400 hover:text-white">&times;</button>
            </header>
            <main class="p-8 flex-grow grid grid-cols-1 lg:grid-cols-2 gap-8 overflow-hidden">
                <div id="scenarios-container" class="bg-gray-900 rounded-xl p-6 flex flex-col gap-4 overflow-y-auto">
                    <!-- Scenario cards will be injected here -->
                </div>
                <div id="answers-container" class="grid grid-cols-2 gap-4 overflow-y-auto">
                    <!-- Drop zones will be injected here -->
                </div>
            </main>
            <div id="activity-feedback" class="absolute bottom-6 left-1/2 -translate-x-1/2 bg-green-600 text-white py-3 px-8 rounded-xl text-2xl font-bold hidden shadow-lg">
                üéâ All Correct! Well Done! üéâ
            </div>
        </div>
    </div>


    <script>
        // --- Data ---
        const governmentData = {
            anarchy: {
                title: 'üö´ Anarchy',
                definition: 'Nobody is in control‚Äîor everyone is, depending on how you look at it.',
                characteristics: [
                    'The human state of existence before any governments developed.',
                    'Similar to animals in the wild, with everyone looking out for themselves.',
                    'Anarchists believe people should freely associate without being subject to a government.'
                ],
                pros: ['Absolute individual freedom.'],
                cons: ['No protection from crime.', 'Potential for chaos and violence.', 'Lack of public services like roads or schools.'],
                powerSource: 'None',
                citizenRole: 'Each person is for themselves.',
                decisionMaker: 'Individuals'
            },
            monarchy: {
                title: 'üëë Monarchy',
                definition: 'A king or queen rules the country, known as a monarch.',
                characteristics: [
                    'Power is passed down through the family line (hereditary).',
                    'In historical times, monarchs held absolute power.',
                    'Modern monarchs often share power and are subject to a constitution (constitutional monarchy).'
                ],
                pros: ['Clear line of succession, leading to stability.'],
                cons: ['Quality of leadership depends on the luck of birth.', 'Citizens have little to no say in who rules.'],
                powerSource: 'Hereditary (family line)',
                citizenRole: 'Subjects who owe loyalty to the monarch.',
                decisionMaker: 'The Monarch'
            },
            dictatorship: {
                title: 'üéñÔ∏è Dictatorship',
                definition: 'One leader has absolute control over citizens\' lives and the constitution.',
                characteristics: [
                    'Other parts of government (courts, lawmaking bodies) have no real power.',
                    'The government does not represent the citizens.',
                    'The leader often uses force to maintain control.'
                ],
                pros: ['Decisions can be made very quickly.'],
                cons: ['Citizens have no rights or freedoms.', 'Leader can be abusive and make poor decisions.', 'Prone to instability if the leader is overthrown.'],
                powerSource: 'Often by military force or coup',
                citizenRole: 'Complete obedience required; no participation.',
                decisionMaker: 'The Dictator'
            },
            oligarchy: {
                title: 'üë• Oligarchy',
                definition: 'A small group of people has all the power. From Greek for "rule by a few."',
                characteristics: [
                    'Power can be based on social class, race, or political party.',
                    'A junta is a type of oligarchy where military officers rule after taking over by force.',
                    'Operates much like a dictatorship, but power is shared among a few.'
                ],
                pros: ['Decisions can be made efficiently by a small, knowledgeable group.'],
                cons: ['The ruling class acts in their own interest.', 'Needs of the citizens are often ignored.'],
                powerSource: 'Wealth, military power, or social status',
                citizenRole: 'To serve the interests of the ruling class.',
                decisionMaker: 'The small ruling group'
            },
            directDemocracy: {
                title: 'üôã‚Äç‚ôÄÔ∏è Direct Democracy',
                definition: 'Citizens are directly involved in the day-to-day work of governing the country.',
                characteristics: [
                    'All citizens participate in lawmaking and government decisions.',
                    'No representatives; citizens vote on everything.',
                    'Very difficult to manage in large countries.'
                ],
                pros: ['Every citizen has an equal say on all issues.', 'Promotes a high level of community involvement.'],
                cons: ['Extremely inefficient for large populations.', 'Requires all citizens to be well-informed on a wide range of topics.'],
                powerSource: 'The citizenry as a whole',
                citizenRole: 'Directly participate in making laws and decisions.',
                decisionMaker: 'All citizens, through voting'
            },
            representativeDemocracy: {
                title: 'üó≥Ô∏è Representative Democracy',
                definition: 'Citizens elect leaders to represent their rights and interests in government.',
                characteristics: [
                    'Elected leaders do the day-to-day work of governing.',
                    'Citizens hold the ultimate power through voting.',
                    'If citizens are unhappy, they can vote for new representatives.'
                ],
                pros: ['More efficient for governing large populations.', 'Representatives can become experts on complex issues.'],
                cons: ['Representatives may not always act in the best interests of their voters.', 'Citizens may feel disconnected from government decisions.'],
                powerSource: 'Elections by the people',
                citizenRole: 'Vote for leaders to represent them.',
                decisionMaker: 'Elected representatives'
            },
            theocracy: {
                title: '‚ú® Theocracy',
                definition: 'A government that recognizes God or a divine being as the ultimate authority.',
                characteristics: [
                    'Religious law is used to rule the people and settle disputes.',
                    'Can be combined with other government types like democracy or monarchy.',
                    'Example: The Republic of Iran is an Islamic theocracy but also holds elections.'
                ],
                pros: ['Can create a strong sense of community and moral unity.'],
                cons: ['Can lead to persecution of religious minorities.', 'May stifle dissent and scientific progress.'],
                powerSource: 'Divine authority or religious texts',
                citizenRole: 'Follow the religious laws of the state.',
                decisionMaker: 'Religious leaders'
            }
        };

        const activityScenarios = [
            { id: 's1', text: 'A small group of wealthy families has ruled this nation for centuries. They make all the laws to benefit their own businesses.', answer: 'oligarchy' },
            { id: 's2', text: 'The nation is in chaos. There is no one in charge, and people just do whatever they want. It is every person for themselves.', answer: 'anarchy' },
            { id: 's3', text: 'Citizens vote every four years to choose their president and members of the legislature.', answer: 'representativeDemocracy' },
            { id: 's4', text: 'Queen Isabella inherited the throne from her father. Her word is law.', answer: 'monarchy' },
            { id: 's5', text: 'The "Supreme Leader" has total control. He shut down the newspapers and jails anyone who criticizes him.', answer: 'dictatorship' },
            { id: 's6', text: 'The country\'s laws are based on a holy book, and religious leaders hold the most power.', answer: 'theocracy' },
            { id: 's7', text: 'In the small town of Harmony, all citizens gather monthly to vote on new laws and community projects.', answer: 'directDemocracy' },
        ];
        
        const timelineData = [
            { year: 'c. 509 BCE', event: 'Roman Republic Established', type: 'A form of Representative Democracy where citizens elected officials.' },
            { year: 'c. 450 BCE', event: 'Ancient Athens', type: 'The height of Direct Democracy, where eligible citizens voted on laws directly.' },
            { year: 'c. 800 - 1800s CE', event: 'Feudalism & Absolute Monarchies', type: 'The dominant form of government in Europe, with kings holding supreme power.' },
            { year: '1215 CE', event: 'Magna Carta Signed', type: 'A key document in England that limited the power of the king, a step towards constitutional monarchy.' },
            { year: '1776 CE', event: 'U.S. Declaration of Independence', type: 'Established a new nation based on the principles of Representative Democracy.'},
            { year: '1920s - 1940s CE', event: 'Rise of Totalitarian Dictatorships', type: 'Saw the rise of powerful dictatorships in Germany, Italy, and the Soviet Union.' },
            { year: 'Post-WWII', event: 'Spread of Democracy', type: 'Many new nations and former colonies adopted democratic forms of government.'}
        ];


        // --- Flowchart & Modal Logic ---
        const categoryNodes = document.querySelectorAll('.category-node');
        const infoModal = document.getElementById('info-modal');
        const modalContent = document.getElementById('modal-content');
        const modalCloseBtn = document.getElementById('modal-close-btn');

        categoryNodes.forEach(node => {
            node.querySelector('.main-category-btn').addEventListener('click', () => {
                node.classList.toggle('open');
            });
        });

        const openModal = (govKey) => {
            const data = governmentData[govKey];
            if (!data) return;

            document.getElementById('modal-title').textContent = data.title;
            document.getElementById('modal-definition').textContent = data.definition;
            const characteristicsList = document.getElementById('modal-characteristics');
            characteristicsList.innerHTML = data.characteristics.map(item => `<li>${item}</li>`).join('');

            const prosContainer = document.getElementById('modal-pros-container');
            const prosList = document.getElementById('modal-pros');
            if (data.pros && data.pros.length > 0) {
                prosList.innerHTML = data.pros.map(item => `<li>${item}</li>`).join('');
                prosContainer.classList.remove('hidden');
            } else {
                prosContainer.classList.add('hidden');
            }

            const consContainer = document.getElementById('modal-cons-container');
            const consList = document.getElementById('modal-cons');
            if (data.cons && data.cons.length > 0) {
                consList.innerHTML = data.cons.map(item => `<li>${item}</li>`).join('');
                consContainer.classList.remove('hidden');
            } else {
                consContainer.classList.add('hidden');
            }
            
            infoModal.classList.remove('hidden');
            setTimeout(() => modalContent.classList.remove('scale-95'), 10);
        };

        const closeModal = (modal) => {
            const content = modal.querySelector('div');
            if (content) content.classList.add('scale-95');
            setTimeout(() => modal.classList.add('hidden'), 200);
        };

        document.querySelectorAll('.sub-node-btn, .special-topic-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                openModal(btn.dataset.gov);
            });
        });
        
        modalCloseBtn.addEventListener('click', () => closeModal(infoModal));
        infoModal.addEventListener('click', e => { if (e.target === infoModal) closeModal(infoModal); });

        // --- Compare Logic ---
        const compareModal = document.getElementById('compare-modal');
        const compareBtn = document.getElementById('compare-btn');
        const compareCloseBtn = document.getElementById('compare-close-btn');
        const compareCol1 = document.getElementById('compare-col-1');
        const compareCol2 = document.getElementById('compare-col-2');
        const compareResults = document.getElementById('compare-results');
        const compareResetBtn = document.getElementById('compare-reset-btn');
        let selection1 = null;
        let selection2 = null;

        const setupCompareTool = () => {
            selection1 = null;
            selection2 = null;
            compareCol1.innerHTML = '<h3>Select First Government:</h3>';
            compareCol2.innerHTML = '<h3>Select Second Government:</h3>';
            compareResults.innerHTML = '';

            Object.keys(governmentData).forEach(key => {
                const btn = document.createElement('button');
                btn.className = 'compare-item w-full text-left p-2 rounded-lg bg-gray-700 hover:bg-gray-600 border-2 border-transparent';
                btn.textContent = governmentData[key].title;
                btn.dataset.govKey = key;
                compareCol1.appendChild(btn.cloneNode(true));
                compareCol2.appendChild(btn.cloneNode(true));
            });

            document.querySelectorAll('.compare-item').forEach(item => {
                item.addEventListener('click', handleCompareSelection);
            });
        };

        const handleCompareSelection = (e) => {
            const selectedKey = e.target.dataset.govKey;
            const parentCol = e.target.parentElement;

            if (parentCol.id === 'compare-col-1') {
                selection1 = selectedKey;
                highlightSelection(compareCol1, selection1);
            } else {
                selection2 = selectedKey;
                highlightSelection(compareCol2, selection2);
            }
            
            if (selection1 && selection2) {
                displayComparison();
            }
        };

        const highlightSelection = (col, key) => {
            col.querySelectorAll('.compare-item').forEach(item => {
                item.classList.remove('selected');
                if (item.dataset.govKey === key) {
                    item.classList.add('selected');
                }
            });
        };

        const displayComparison = () => {
            const data1 = governmentData[selection1];
            const data2 = governmentData[selection2];
            
            const tableHTML = `
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-gray-900">
                            <th class="p-3 border border-gray-600">Feature</th>
                            <th class="p-3 border border-gray-600 text-xl font-bold">${data1.title}</th>
                            <th class="p-3 border border-gray-600 text-xl font-bold">${data2.title}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="bg-gray-800">
                            <td class="p-3 border border-gray-600 font-bold">How is power obtained?</td>
                            <td class="p-3 border border-gray-600">${data1.powerSource}</td>
                            <td class="p-3 border border-gray-600">${data2.powerSource}</td>
                        </tr>
                        <tr class="bg-gray-700">
                            <td class="p-3 border border-gray-600 font-bold">What is the role of the citizen?</td>
                            <td class="p-3 border border-gray-600">${data1.citizenRole}</td>
                            <td class="p-3 border border-gray-600">${data2.citizenRole}</td>
                        </tr>
                        <tr class="bg-gray-800">
                            <td class="p-3 border border-gray-600 font-bold">Who makes the decisions?</td>
                            <td class="p-3 border border-gray-600">${data1.decisionMaker}</td>
                            <td class="p-3 border border-gray-600">${data2.decisionMaker}</td>
                        </tr>
                    </tbody>
                </table>
            `;
            compareResults.innerHTML = tableHTML;
        };

        compareBtn.addEventListener('click', () => {
            setupCompareTool();
            compareModal.classList.remove('hidden');
        });
        compareResetBtn.addEventListener('click', setupCompareTool);
        compareCloseBtn.addEventListener('click', () => closeModal(compareModal));
        compareModal.addEventListener('click', e => { if (e.target === compareModal) closeModal(compareModal); });


        // --- Timeline Logic ---
        const timelineModal = document.getElementById('timeline-modal');
        const timelineBtn = document.getElementById('timeline-btn');
        const timelineCloseBtn = document.getElementById('timeline-close-btn');
        const timelineContainer = document.getElementById('timeline-container');

        const setupTimeline = () => {
            timelineContainer.innerHTML = '';
            timelineData.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'timeline-item mb-8';
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'bg-gray-900 p-4 rounded-lg shadow-lg';
                contentDiv.innerHTML = `
                    <span class="font-bold text-yellow-400 text-lg">${item.year}</span>
                    <h3 class="text-2xl font-black mt-1">${item.event}</h3>
                    <p class="text-gray-300">${item.type}</p>
                `;
                itemDiv.appendChild(contentDiv);
                timelineContainer.appendChild(itemDiv);
            });
        };
        
        timelineBtn.addEventListener('click', () => {
            setupTimeline();
            timelineModal.classList.remove('hidden');
        });
        timelineCloseBtn.addEventListener('click', () => closeModal(timelineModal));
        timelineModal.addEventListener('click', e => { if (e.target === timelineModal) closeModal(timelineModal); });


        // --- Activity Logic ---
        const activityModal = document.getElementById('activity-modal');
        const testKnowledgeBtn = document.getElementById('test-knowledge-btn');
        const activityCloseBtn = document.getElementById('activity-close-btn');
        const scenariosContainer = document.getElementById('scenarios-container');
        const answersContainer = document.getElementById('answers-container');
        const activityFeedback = document.getElementById('activity-feedback');
        
        let correctAnswers = 0;
        
        const setupActivity = () => {
            correctAnswers = 0;
            activityFeedback.classList.add('hidden');
            scenariosContainer.innerHTML = '';
            answersContainer.innerHTML = '';

            const shuffledScenarios = [...activityScenarios].sort(() => Math.random() - 0.5);

            shuffledScenarios.forEach(scenario => {
                const card = document.createElement('div');
                card.id = scenario.id;
                card.className = 'scenario-card draggable-item bg-gray-800 p-4 rounded-lg border border-gray-700 cursor-grab';
                card.draggable = true;
                card.textContent = scenario.text;
                card.dataset.answer = scenario.answer;
                scenariosContainer.appendChild(card);
            });

            const uniqueAnswers = [...new Set(activityScenarios.map(s => s.answer))];
            uniqueAnswers.forEach(answerKey => {
                const dropZone = document.createElement('div');
                dropZone.className = 'drop-zone rounded-xl p-4 h-32 flex items-center justify-center';
                dropZone.dataset.accepts = answerKey;
                
                const title = document.createElement('h3');
                title.className = 'text-2xl font-bold text-center';
                title.textContent = governmentData[answerKey].title;
                dropZone.appendChild(title);
                
                answersContainer.appendChild(dropZone);
            });
            
            addDragDropListeners();
        };

        const addDragDropListeners = () => {
            const draggables = document.querySelectorAll('.draggable-item');
            const dropZones = document.querySelectorAll('.drop-zone');

            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', (e) => {
                    draggable.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', draggable.id);
                });
                draggable.addEventListener('dragend', () => {
                    draggable.classList.remove('dragging');
                });
            });

            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.classList.add('drag-over');
                });
                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('drag-over');
                });
                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('drag-over');
                    const id = e.dataTransfer.getData('text');
                    const draggable = document.getElementById(id);

                    if (zone.dataset.accepts === draggable.dataset.answer) {
                        zone.classList.remove('incorrect');
                        zone.classList.add('correct');
                        zone.appendChild(draggable);
                        draggable.draggable = false;
                        draggable.style.cursor = 'default';
                        draggable.classList.remove('bg-gray-800', 'border-gray-700');
                        draggable.classList.add('bg-transparent', 'border-0', 'text-sm', 'text-center', 'mt-2', 'text-gray-300');
                        correctAnswers++;
                        if (correctAnswers === activityScenarios.length) {
                            activityFeedback.classList.remove('hidden');
                        }
                    } else {
                        zone.classList.add('incorrect');
                        setTimeout(() => zone.classList.remove('incorrect'), 500);
                    }
                });
            });
        };

        testKnowledgeBtn.addEventListener('click', () => {
            setupActivity();
            activityModal.classList.remove('hidden');
        });
        activityCloseBtn.addEventListener('click', () => closeModal(activityModal));
        activityModal.addEventListener('click', e => { if (e.target === activityModal) closeModal(activityModal); });
    </script>
</body>
</html>


